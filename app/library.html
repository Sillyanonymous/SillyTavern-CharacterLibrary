<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SillyTavern Character Library</title>
    <link rel="stylesheet" href="library.css?v=48">
    <link rel="stylesheet" href="library-mobile.css?v=1" media="screen and (max-width: 768px)">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- DOMPurify for HTML sanitization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Top Toolbar -->
        <header class="topbar">
            <div class="logo-area">
                <i class="fa-solid fa-layer-group accent-icon"></i>
                <h1>Character<span>Library</span></h1>
            </div>

            <div class="view-toggle">
                <button class="view-toggle-btn active" data-view="characters">
                    <i class="fa-solid fa-users"></i> Characters
                </button>
                <button class="view-toggle-btn" data-view="chats">
                    <i class="fa-solid fa-comments"></i> Chats
                </button>
                <button class="view-toggle-btn" data-view="chub">
                    <i class="fa-solid fa-cloud-arrow-down"></i> ChubAI
                </button>
            </div>

            <div class="search-area">
                <div class="search-box">
                    <i class="fa-solid fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search characters...">
                    <button id="clearSearchBtn" class="clear-search-btn hidden" title="Clear search">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>
                <div class="search-settings-container">
                    <button id="searchSettingsBtn" class="glass-btn icon-only" title="Search Settings">
                        <i class="fa-solid fa-sliders"></i>
                    </button>
                    <div id="searchSettingsMenu" class="dropdown-menu hidden">
                        <label><input type="checkbox" id="searchName" checked> Character Name</label>
                        <label><input type="checkbox" id="searchTags" checked> Tags</label>
                        <label><input type="checkbox" id="searchAuthor" checked> Author</label>
                        <label><input type="checkbox" id="searchNotes"> Creator's Notes</label>
                    </div>
                </div>
            </div>

            <div class="filter-area" id="filterArea">
                <select id="sortSelect" class="glass-select">
                    <option value="name_asc" data-icon="fa-solid fa-arrow-down-a-z">Name (A-Z)</option>
                    <option value="name_desc" data-icon="fa-solid fa-arrow-up-z-a">Name (Z-A)</option>
                    <option value="date_new" data-icon="fa-solid fa-clock-rotate-left">Last Modified (Newest)</option>
                    <option value="date_old" data-icon="fa-solid fa-clock-rotate-left">Last Modified (Oldest)</option>
                    <option value="created_new" data-icon="fa-solid fa-calendar-plus">Date Created (Newest)</option>
                    <option value="created_old" data-icon="fa-solid fa-calendar-plus">Date Created (Oldest)</option>
                </select>
                <button id="favoritesFilterBtn" class="glass-btn favorites-filter-btn" title="Show favorites only">
                    <i class="fa-solid fa-star"></i>
                </button>
                <div class="filter-group" style="position: relative;">
                    <button id="tagFilterBtn" class="glass-btn tag-filter-btn" title="Filter by tags">
                        <i class="fa-solid fa-tags"></i> <span id="tagFilterLabel">Tags</span>
                    </button>
                    <div id="tagFilterPopup" class="dropdown-menu tag-filter-popup hidden" style="width: 250px; max-height: 400px;">
                        <div class="tag-search-row">
                            <input type="text" id="tagSearchInput" placeholder="Find tags...">
                            <button id="clearAllTagsBtn" class="glass-btn icon-only clear-tags-btn" title="Clear all tag filters">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                        <div id="tagFilterContent" style="overflow-y: auto; flex: 1;">
                             <!-- Tags injected via JS -->
                        </div>
                    </div>
                </div>
                <button id="refreshBtn" class="glass-btn icon-only" title="Refresh">
                    <i class="fa-solid fa-sync"></i>
                </button>
                <div class="gallery-sync-container">
                    <button id="gallerySyncStatusBtn" class="glass-btn icon-only gallery-sync-btn" title="Gallery sync status">
                        <i class="fa-solid fa-circle-info"></i>
                        <span class="warning-badge hidden"></span>
                    </button>
                    <div id="gallerySyncDropdown" class="dropdown-menu gallery-sync-dropdown hidden">
                        <div class="sync-dropdown-content">
                            <div class="sync-dropdown-loading">
                                <i class="fa-solid fa-spinner fa-spin"></i> Checking...
                            </div>
                        </div>
                    </div>
                </div>
                <div class="more-options-container">
                    <button id="moreOptionsBtn" class="glass-btn icon-only" title="More Options">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                    <div id="moreOptionsMenu" class="dropdown-menu hidden">
                        <button id="importBtn" class="dropdown-item">
                            <i class="fa-solid fa-download"></i> Import Characters
                        </button>
                        <button id="checkDuplicatesBtn" class="dropdown-item">
                            <i class="fa-solid fa-clone"></i> Find Duplicates
                        </button>
                        <button id="bulkChubLinkBtn" class="dropdown-item">
                            <i class="fa-solid fa-link"></i> Link ChubAI Characters
                        </button>
                        <div class="dropdown-divider"></div>
                        <button id="menuRefreshBtn" class="dropdown-item topbar-overflow-item">
                            <i class="fa-solid fa-sync"></i> Refresh
                        </button>
                        <button id="menuGallerySyncBtn" class="dropdown-item topbar-overflow-item">
                            <i class="fa-solid fa-circle-info"></i> Gallery Sync Status
                        </button>
                        <button id="menuMultiSelectBtn" class="dropdown-item topbar-overflow-item">
                            <i class="fa-solid fa-object-group"></i> Select Mode
                        </button>
                        <button id="menuSortBtn" class="dropdown-item topbar-overflow-item-narrow">
                            <i class="fa-solid fa-arrow-down-wide-short"></i> Sort
                        </button>
                        <button id="menuFavoritesBtn" class="dropdown-item topbar-overflow-item-narrow">
                            <i class="fa-solid fa-star"></i> Favorites Filter
                        </button>
                        <button id="menuTagsBtn" class="dropdown-item topbar-overflow-item-narrow">
                            <i class="fa-solid fa-tags"></i> Tag Filter
                        </button>
                        <div class="dropdown-divider topbar-overflow-item"></div>
                        <button id="galleryInfoBtn" class="dropdown-item">
                            <i class="fa-solid fa-circle-info"></i> Help & Tips
                        </button>
                        <button id="gallerySettingsBtn" class="dropdown-item">
                            <i class="fa-solid fa-gear"></i> Gallery Settings
                        </button>
                    </div>
                </div>
            </div>

            <!-- Filters wrapper - prevents layout shift by maintaining consistent space -->
            <div class="filters-wrapper">
                <!-- Chats-specific filters (hidden by default via CSS) -->
                <div class="filter-area chats-filters" id="chatsFilterArea">
                    <select id="chatsSortSelect" class="glass-select">
                        <option value="recent" data-icon="fa-solid fa-clock">Most Recent</option>
                        <option value="oldest" data-icon="fa-solid fa-hourglass">Oldest First</option>
                        <option value="char_asc" data-icon="fa-solid fa-arrow-down-a-z">Character (A-Z)</option>
                        <option value="char_desc" data-icon="fa-solid fa-arrow-up-z-a">Character (Z-A)</option>
                        <option value="most_messages" data-icon="fa-solid fa-comments">Most Messages</option>
                        <option value="least_messages" data-icon="fa-solid fa-comment">Least Messages</option>
                        <option value="longest_chat" data-icon="fa-solid fa-ruler">Longest Chat</option>
                        <option value="shortest_chat" data-icon="fa-solid fa-ruler">Shortest Chat</option>
                        <option value="most_chats" data-icon="fa-solid fa-layer-group">Most Chats (Character)</option>
                    </select>
                    <div class="grouping-toggle">
                        <button class="glass-btn grouping-btn active" data-group="flat" title="Flat list">
                            <i class="fa-solid fa-list"></i>
                        </button>
                        <button class="glass-btn grouping-btn" data-group="grouped" title="Group by character">
                            <i class="fa-solid fa-layer-group"></i>
                        </button>
                    </div>
                    <button id="refreshChatsViewBtn" class="glass-btn icon-only" title="Refresh Chats">
                        <i class="fa-solid fa-sync"></i>
                    </button>
                </div>

                <!-- ChubAI-specific filters (hidden by default) -->
                <div class="filter-area chub-filters" id="chubFilterArea">
                    <!-- Discovery Mode Toggle -->
                    <div class="chub-view-toggle">
                        <button class="chub-view-btn active" data-chub-view="browse" title="Browse all characters">
                            <i class="fa-solid fa-compass"></i> Browse
                        </button>
                        <button class="chub-view-btn" data-chub-view="timeline" title="New from followed authors (requires token)">
                            <i class="fa-solid fa-users"></i> Following
                        </button>
                    </div>
                    
                    <!-- Sort dropdown container - holds both Browse and Following sorts in same spot -->
                    <div class="chub-sort-container">
                        <!-- Discovery Preset (combined sort + time logic) - Browse mode -->
                        <select id="chubDiscoveryPreset" class="glass-select" title="Discovery mode">
                            <optgroup label="Popular">
                                <option value="popular_week" selected>üî• Hot This Week</option>
                                <option value="popular_month">üìà Hot This Month</option>
                                <option value="popular_all">üëë Most Downloaded</option>
                            </optgroup>
                            <optgroup label="Quality">
                                <option value="rated_week">‚≠ê Top Rated (Week)</option>
                                <option value="rated_all">‚≠ê Top Rated (All Time)</option>
                            </optgroup>
                            <optgroup label="Discovery">
                                <option value="newest">üÜï Newest</option>
                                <option value="updated">üîÑ Recently Updated</option>
                                <option value="recent_hits">üåü Recent Hits</option>
                                <option value="random">üé≤ Random</option>
                            </optgroup>
                        </select>
                        
                        <!-- Timeline Sort (Following mode) - hidden by default -->
                        <select id="chubTimelineSortHeader" class="glass-select chub-filter-hidden" title="Sort timeline">
                            <option value="newest">üÜï Newest Created</option>
                            <option value="updated">üîÑ Recently Updated</option>
                            <option value="oldest">üïê Oldest First</option>
                            <option value="name_asc">üìù Name A-Z</option>
                            <option value="name_desc">üìù Name Z-A</option>
                            <option value="downloads">üì• Most Downloads</option>
                            <option value="favorites">‚ù§Ô∏è Most Favorites</option>
                            <option value="rating">‚≠ê Top Rated</option>
                        </select>
                    </div>
                    
                    <!-- Tags & Advanced Filters -->
                    <div class="chub-tags-dropdown-container" style="position: relative;">
                        <button id="chubTagsBtn" class="glass-btn" title="Tag filters and advanced options">
                            <i class="fa-solid fa-tags"></i> <span id="chubTagsBtnLabel">Tags</span>
                        </button>
                        <div id="chubTagsDropdown" class="dropdown-menu chub-tags-dropdown hidden">
                            <!-- Tag Search -->
                            <div class="chub-tags-search-row">
                                <input type="text" id="chubTagsSearchInput" placeholder="Search tags...">
                                <button id="chubTagsClearBtn" class="glass-btn icon-only" title="Clear all tag filters">
                                    <i class="fa-solid fa-rotate-left"></i>
                                </button>
                            </div>
                            
                            <!-- Tag List (tri-state) -->
                            <div class="chub-tags-list" id="chubTagsList">
                                <div class="chub-tags-loading"><i class="fa-solid fa-spinner fa-spin"></i> Loading tags...</div>
                            </div>
                            
                            <hr style="margin: 10px 0; border-color: var(--glass-border);">
                            
                            <!-- Advanced Options -->
                            <div class="dropdown-section-title"><i class="fa-solid fa-gear"></i> Advanced Options</div>
                            
                            <!-- Sort Direction -->
                            <div class="chub-advanced-option">
                                <label><i class="fa-solid fa-arrow-down-wide-short"></i> Sort Direction</label>
                                <select id="chubSortDirection" class="glass-select-small">
                                    <option value="desc" selected data-icon="fa-solid fa-arrow-down-wide-short">Descending</option>
                                    <option value="asc" data-icon="fa-solid fa-arrow-up-short-wide">Ascending</option>
                                </select>
                            </div>
                            
                            <!-- Min Tokens -->
                            <div class="chub-advanced-option">
                                <label><i class="fa-solid fa-text-width"></i> Min Tokens</label>
                                <input type="number" id="chubMinTokens" class="glass-input-small" value="50" min="0" max="100000" step="100">
                            </div>
                            
                            <!-- Max Tokens -->
                            <div class="chub-advanced-option">
                                <label><i class="fa-solid fa-text-width"></i> Max Tokens</label>
                                <input type="number" id="chubMaxTokens" class="glass-input-small" value="100000" min="0" max="500000" step="1000">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Feature Filters -->
                    <div class="chub-more-filters" style="position: relative;">
                        <button id="chubFiltersBtn" class="glass-btn" title="Filter by character features">
                            <i class="fa-solid fa-sliders"></i> Features
                        </button>
                        <div id="chubFiltersDropdown" class="dropdown-menu hidden" style="width: 240px;">
                            <div class="dropdown-section-title">Character must have:</div>
                            <label class="filter-checkbox"><input type="checkbox" id="chubFilterImages"> <i class="fa-solid fa-images"></i> Image Gallery</label>
                            <label class="filter-checkbox"><input type="checkbox" id="chubFilterLore"> <i class="fa-solid fa-book"></i> Lorebook</label>
                            <label class="filter-checkbox"><input type="checkbox" id="chubFilterExpressions"> <i class="fa-solid fa-face-smile"></i> Expressions</label>
                            <label class="filter-checkbox"><input type="checkbox" id="chubFilterGreetings"> <i class="fa-solid fa-comments"></i> Alt Greetings</label>
                            <hr style="margin: 8px 0; border-color: var(--glass-border);">
                            <div class="dropdown-section-title">Personal <span style="font-size: 0.8em; opacity: 0.6;">(requires login)</span>:</div>
                            <label class="filter-checkbox"><input type="checkbox" id="chubFilterFavorites"> <i class="fa-solid fa-heart" style="color: #e74c3c;"></i> My Favorites</label>
                            <hr style="margin: 8px 0; border-color: var(--glass-border);">
                            <div class="dropdown-section-title">Library:</div>
                            <label class="filter-checkbox"><input type="checkbox" id="chubFilterHideOwned"> <i class="fa-solid fa-check"></i> Hide Owned Characters</label>
                        </div>
                    </div>
                    
                    <!-- Content Toggles -->
                    <button id="chubNsfwToggle" class="glass-btn nsfw-toggle" title="Toggle NSFW content">
                        <i class="fa-solid fa-shield-halved"></i> <span>SFW Only</span>
                    </button>
                    
                    <!-- Account & Refresh -->
                    <button id="chubLoginBtn" class="glass-btn icon-only" title="ChubAI Login Settings">
                        <i class="fa-solid fa-user-circle"></i>
                    </button>
                    <button id="refreshChubBtn" class="glass-btn icon-only" title="Refresh">
                        <i class="fa-solid fa-sync"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Grid Area -->
        <main class="gallery-content">
            <div id="loading" class="loading-spinner">
                <i class="fa-solid fa-circle-notch fa-spin"></i> Loading Library...
            </div>
            
            <div id="characterGrid" class="character-grid">
                <!-- Cards will be injected here -->
            </div>

            <!-- Chats View (hidden by default) -->
            <div id="chatsView" class="chats-view hidden">
                <div id="chatsGrid" class="chats-grid">
                    <!-- Chat cards will be injected here -->
                </div>
                <div id="chatsGroupedView" class="chats-grouped-view hidden">
                    <!-- Grouped chat cards will be injected here -->
                </div>
            </div>

            <!-- ChubAI View (hidden by default) -->
            <div id="chubView" class="chub-view hidden">
                <!-- Browse Section -->
                <div id="chubBrowseSection" class="chub-section">
                    <!-- Search Bar for ChubAI -->
                    <div class="chub-search-bar">
                        <div class="chub-search-input-wrapper">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" id="chubSearchInput" placeholder="Search ChubAI characters...">
                            <button id="chubClearSearchBtn" class="chub-search-clear hidden" title="Clear search">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                            <button id="chubSearchBtn" class="chub-search-submit">
                                <i class="fa-solid fa-arrow-right"></i>
                            </button>
                        </div>
                        <!-- Creator Search -->
                        <div class="chub-creator-search">
                            <div class="chub-creator-search-wrapper">
                                <i class="fa-solid fa-user"></i>
                                <input type="text" id="chubCreatorSearchInput" placeholder="Search by creator...">
                                <button id="chubCreatorSearchBtn" class="chub-search-submit" title="Search by creator">
                                    <i class="fa-solid fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Author Filter Banner (shown when filtering by author) -->
                    <div id="chubAuthorBanner" class="chub-author-banner hidden">
                        <div class="chub-author-banner-content">
                            <i class="fa-solid fa-user"></i>
                            <span>Showing characters by <strong id="chubAuthorBannerName">Author</strong></span>
                        </div>
                        <div class="chub-author-banner-actions">
                            <select id="chubAuthorSortSelect" class="glass-select" title="Sort author's characters">
                                <option value="id" selected>üÜï Newest Created</option>
                                <option value="last_activity_at">üîÑ Recently Updated</option>
                                <option value="download_count">üì• Most Downloaded</option>
                                <option value="star_count">‚≠ê Top Rated</option>
                            </select>
                            <button id="chubFollowAuthorBtn" class="glass-btn" title="Follow this author on ChubAI">
                                <i class="fa-solid fa-heart"></i> <span>Follow</span>
                            </button>
                            <button id="chubClearAuthorBtn" class="glass-btn icon-only" title="Clear author filter">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Results Grid -->
                    <div id="chubGrid" class="chub-grid">
                        <!-- ChubAI cards will be injected here -->
                    </div>
                    
                    <!-- Load More Button -->
                    <div class="chub-load-more" id="chubLoadMore" style="display: none;">
                        <button id="chubLoadMoreBtn" class="glass-btn">
                            <i class="fa-solid fa-plus"></i> Load More
                        </button>
                    </div>
                </div>
                
                <!-- Timeline Section (hidden by default) -->
                <div id="chubTimelineSection" class="chub-section hidden">
                    <div class="chub-timeline-header">
                        <div class="chub-timeline-header-left">
                            <h3><i class="fa-solid fa-clock"></i> Timeline</h3>
                            <p>New characters from authors you follow</p>
                        </div>
                    </div>
                    <div id="chubTimelineGrid" class="chub-grid">
                        <!-- Timeline cards will be injected here -->
                    </div>
                    <div class="chub-load-more" id="chubTimelineLoadMore" style="display: none;">
                        <button id="chubTimelineLoadMoreBtn" class="glass-btn">
                            <i class="fa-solid fa-plus"></i> Load More
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Chat Preview Modal -->
    <div id="chatPreviewModal" class="modal-overlay hidden">
        <div class="modal-glass chat-preview-modal">
            <div class="modal-header">
                <div class="chat-preview-header-info">
                    <img id="chatPreviewAvatar" src="" alt="" class="chat-preview-avatar">
                    <div>
                        <h2 id="chatPreviewTitle">Chat Preview</h2>
                        <p class="chat-preview-meta">
                            <span id="chatPreviewCharName"></span> ‚Ä¢ 
                            <span id="chatPreviewMessageCount"></span> messages ‚Ä¢ 
                            <span id="chatPreviewDate"></span>
                        </p>
                    </div>
                </div>
                <div class="modal-controls">
                    <button id="chatPreviewOpenBtn" class="action-btn primary"><i class="fa-solid fa-arrow-up-right-from-square"></i> Open in SillyTavern</button>
                    <button id="chatPreviewDeleteBtn" class="action-btn danger-hover"><i class="fa-solid fa-trash"></i></button>
                    <button class="close-btn" id="chatPreviewClose">&times;</button>
                </div>
            </div>
            <div class="chat-preview-body">
                <div id="chatPreviewMessages" class="chat-preview-messages">
                    <div class="chats-loading"><i class="fa-solid fa-spinner fa-spin"></i> Loading messages...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ChubAI Login Modal -->
    <div id="chubLoginModal" class="modal-overlay hidden">
        <div class="modal-glass chub-login-modal">
            <div class="modal-header">
                <h2><i class="fa-solid fa-key"></i> ChubAI Authentication</h2>
                <button class="close-btn" id="chubLoginClose">&times;</button>
            </div>
            <div class="chub-login-body">
                <p class="chub-login-info">
                    <i class="fa-solid fa-check-circle" style="color: #2ecc71;"></i>
                    <strong>Browsing and downloading public characters works without a token!</strong>
                </p>
                <p class="chub-login-info">
                    <i class="fa-solid fa-key" style="color: var(--accent);"></i>
                    <strong>Optional:</strong> Add your URQL_TOKEN to access your favorites and restricted content.
                </p>
                
                <div class="chub-login-form">
                    <div class="form-group">
                        <label for="chubApiKeyInput">URQL_TOKEN</label>
                        <input type="password" id="chubApiKeyInput" class="glass-input" placeholder="Paste your URQL_TOKEN here..." autocomplete="off">
                    </div>
                    <label class="checkbox-label" style="margin-top: 10px;">
                        <input type="checkbox" id="chubRememberKey"> Remember token
                    </label>
                    <div class="chub-login-status" style="display:none;"></div>
                </div>
                
                <details style="margin-top: 15px; background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px;">
                    <summary style="cursor: pointer; color: var(--accent);">
                        <i class="fa-solid fa-question-circle"></i> How to get your URQL_TOKEN
                    </summary>
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--glass-border); font-size: 0.9rem; color: var(--text-secondary);">
                        <ol style="margin: 0; padding-left: 20px; line-height: 1.8;">
                            <li>Go to <a href="https://chub.ai" target="_blank" style="color: var(--accent);">chub.ai</a> and log in</li>
                            <li>Open your browser's Developer Tools (F12)</li>
                            <li>Go to the <strong>Application</strong> tab (or Storage in Firefox)</li>
                            <li>In the left sidebar, expand <strong>Local Storage</strong></li>
                            <li>Click on <code>https://chub.ai</code></li>
                            <li>Find the key <code style="color: #e74c3c; font-weight: bold;">URQL_TOKEN</code> and copy its value</li>
                        </ol>
                        <p style="margin-top: 10px; font-style: italic;">
                            The token is a long string that authenticates you with ChubAI's API.
                        </p>
                    </div>
                </details>
                
                <div class="chub-login-actions">
                    <button id="chubSaveKeyBtn" class="action-btn primary">
                        <i class="fa-solid fa-save"></i> Save Token
                    </button>
                    <button id="chubClearKeyBtn" class="action-btn secondary" style="display:none;">
                        <i class="fa-solid fa-trash"></i> Clear Token
                    </button>
                    <a href="https://chub.ai" target="_blank" class="action-btn secondary">
                        <i class="fa-solid fa-external-link"></i> ChubAI Website
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- ChubAI Character Preview Modal -->
    <div id="chubCharModal" class="modal-overlay hidden">
        <div class="modal-glass chub-char-modal">
            <div class="modal-header">
                <div class="chub-char-header-info">
                    <img id="chubCharAvatar" src="" alt="" class="chub-char-avatar">
                    <div>
                        <h2 id="chubCharName">Character Name</h2>
                        <p class="chub-char-meta">
                            by <a id="chubCharCreator" href="#" title="Click to see all characters by this author">Creator</a>
                            <a id="chubCreatorExternal" href="#" target="_blank" class="creator-external-link" title="Open author's ChubAI profile"><i class="fa-solid fa-external-link"></i></a> ‚Ä¢
                            <span id="chubCharRating" title="Rating"><i class="fa-solid fa-star"></i> 0</span> ‚Ä¢
                            <span id="chubCharDownloads" title="Downloads"><i class="fa-solid fa-download"></i> 0</span> ‚Ä¢
                            <span id="chubCharFavoriteBtn" class="chub-favorite-btn-inline" title="Add to favorites on ChubAI"><i class="fa-regular fa-heart"></i> <span id="chubCharFavoriteCount">0</span></span>
                        </p>
                    </div>
                </div>
                <div class="modal-controls">
                    <a id="chubOpenInBrowserBtn" href="#" target="_blank" class="action-btn secondary" title="Open on ChubAI">
                        <i class="fa-solid fa-external-link"></i> Open
                    </a>
                    <button id="chubDownloadBtn" class="action-btn primary" title="Download to SillyTavern">
                        <i class="fa-solid fa-download"></i> Import
                    </button>
                    <button class="close-btn" id="chubCharClose">&times;</button>
                </div>
            </div>
            <div class="chub-char-body">
                <div class="chub-char-tagline" id="chubCharTaglineSection" style="display: none;">
                    <i class="fa-solid fa-quote-left"></i>
                    <div id="chubCharTagline" class="chub-tagline-text"></div>
                </div>

                <div class="chub-char-meta-grid">
                    <div class="chub-char-stats">
                        <div class="chub-stat">
                            <i class="fa-solid fa-message"></i>
                            <span id="chubCharTokens">0</span> tokens
                        </div>
                        <div class="chub-stat">
                            <i class="fa-solid fa-calendar"></i>
                            <span id="chubCharDate">Unknown</span>
                        </div>
                        <div class="chub-stat" id="chubCharGreetingsStat" style="display: none;">
                            <i class="fa-solid fa-comment-dots"></i>
                            <span id="chubCharGreetingsCount">0</span> greetings
                        </div>
                        <div class="chub-stat" id="chubCharLorebookStat" style="display: none;">
                            <i class="fa-solid fa-book"></i>
                            Lorebook
                        </div>
                    </div>
                    <div class="chub-char-tags" id="chubCharTags">
                        <!-- Tags injected here -->
                    </div>
                </div>
                
                <!-- Creator's Notes Section (public ChubAI description) -->
                <div class="chub-char-section">
                    <h3 class="chub-section-title" data-section="chubCharCreatorNotes" data-label="Creator's Notes" data-icon="fa-solid fa-feather-pointed" title="Click to expand">
                        <i class="fa-solid fa-feather-pointed"></i> Creator's Notes
                    </h3>
                    <div id="chubCharCreatorNotes" class="scrolling-text">
                        No description available.
                    </div>
                </div>
                
                <!-- Character Definition Description Section -->
                <div class="chub-char-section" id="chubCharDescriptionSection" style="display: none;">
                    <h3 class="chub-section-title" data-section="chubCharDescription" data-label="Description" data-icon="fa-solid fa-scroll" title="Click to expand">
                        <i class="fa-solid fa-scroll"></i> Description
                    </h3>
                    <div id="chubCharDescription" class="scrolling-text"></div>
                </div>
                
                <!-- Personality Section -->
                <div class="chub-char-section" id="chubCharPersonalitySection" style="display: none;">
                    <h3 class="chub-section-title" data-section="chubCharPersonality" data-label="Personality" data-icon="fa-solid fa-brain" title="Click to expand">
                        <i class="fa-solid fa-brain"></i> Personality
                    </h3>
                    <div id="chubCharPersonality" class="scrolling-text"></div>
                </div>
                
                <!-- Scenario Section -->
                <div class="chub-char-section" id="chubCharScenarioSection" style="display: none;">
                    <h3 class="chub-section-title" data-section="chubCharScenario" data-label="Scenario" data-icon="fa-solid fa-theater-masks" title="Click to expand">
                        <i class="fa-solid fa-theater-masks"></i> Scenario
                    </h3>
                    <div id="chubCharScenario" class="scrolling-text"></div>
                </div>
                
                <!-- First Message Section -->
                <div class="chub-char-section" id="chubCharFirstMsgSection" style="display: none;">
                    <h3 class="chub-section-title" data-section="chubCharFirstMsg" data-label="First Message" data-icon="fa-solid fa-message" title="Click to expand">
                        <i class="fa-solid fa-message"></i> First Message
                    </h3>
                    <div id="chubCharFirstMsg" class="scrolling-text first-message-preview"></div>
                </div>

                <!-- Alternate Greetings Section -->
                <div class="chub-char-section" id="chubCharAltGreetingsSection" style="display: none;">
                    <h3 class="chub-section-title" data-section="chubCharAltGreetings" data-label="Alternate Greetings" data-icon="fa-solid fa-comments" title="Click to expand">
                        <i class="fa-solid fa-comments"></i> Alternate Greetings <span class="chub-section-count" id="chubCharAltGreetingsCount"></span>
                    </h3>
                    <div id="chubCharAltGreetings" class="chub-alt-greetings-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit/Detail Modal -->
    <div id="charModal" class="modal-overlay hidden">
        <div class="modal-glass">
            <div class="modal-header">
                <h2 id="modalTitle">Character Name</h2>
                <div class="modal-controls">
                    <button id="favoriteCharBtn" class="action-btn favorite-btn" title="Toggle Favorite">
                        <i class="fa-regular fa-star"></i>
                    </button>
                    <button id="deleteCharBtn" class="action-btn danger-hover" title="Delete Character">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                    <button id="modalChatBtn" class="action-btn primary"><i class="fa-solid fa-comments"></i> Chat</button>
                    <button class="close-btn" id="modalClose">&times;</button>
                </div>
            </div>
            
            <div class="modal-body">
                <div class="modal-sidebar">
                    <div class="char-portrait-container">
                        <img id="modalImage" src="" alt="Character Portrait">
                        <!-- Sprite/Avatar Navigation - Disabled (SillyTavern standard characters are single-image)
                        <div class="gallery-nav">
                            <button id="prevSprite" class="nav-btn"><i class="fa-solid fa-chevron-left"></i></button>
                            <span id="spriteCounter">1/1</span>
                            <button id="nextSprite" class="nav-btn"><i class="fa-solid fa-chevron-right"></i></button>
                        </div>
                        -->
                    </div>
                    <!--
                    <div class="sidebar-actions">
                        <button class="glass-btn full-width"><i class="fa-solid fa-image"></i> Change Avatar</button>
                    </div>
                    -->
                    <div class="sidebar-section">
                        <div class="sidebar-label">
                            <i class="fa-solid fa-tags"></i> Tags
                        </div>
                        <div class="tags-container" id="modalTags">
                            <!-- Tags injected here -->
                        </div>
                        <div class="tag-input-wrapper hidden" id="tagInputWrapper">
                            <input type="text" id="tagInput" class="glass-input tag-input" placeholder="Add tag..." autocomplete="off">
                            <div id="tagAutocomplete" class="tag-autocomplete hidden"></div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-content-tabs">
                    <div class="tab-nav">
                        <button class="tab-btn active" data-tab="details">Details</button>
                        <button class="tab-btn" data-tab="edit">Edit</button>
                        <button class="tab-btn" data-tab="chats">Chats</button>
                        <button class="tab-btn" data-tab="gallery">Gallery</button>
                        <button class="tab-btn" data-tab="related">Related</button>
                        <button class="tab-btn hidden" data-tab="versions" id="versionsTabBtn"></button>
                        <button class="tab-btn hidden" data-tab="info" id="infoTabBtn"><i class="fa-solid fa-microscope"></i> Info</button>
                    </div>
                    
                    <div class="tab-pane active" id="pane-details">
                        <p class="meta-info">
                            Created: <span id="modalDate"></span> 
                            <span id="modalAuthorContainer" style="display:none">‚Ä¢ Author: <a href="#" id="modalAuthor" class="creator-link" title="Click to filter by this creator"></a></span>
                            <span class="chub-link-indicator" id="chubLinkIndicator" title="Click to link/manage ChubAI connection">
                                ‚Ä¢ <i class="fa-solid fa-link"></i> <span class="chub-link-text">ChubAI</span>
                            </span>
                        </p>

                        <div class="chub-tagline-row" id="modalChubTaglineRow" style="display:none;">
                            <span class="chub-tagline-text" id="modalChubTagline"></span>
                        </div>
                        
                        <div class="creator-notes-box" id="modalCreatorNotesBox" style="display:none; margin-bottom: 25px;">
                            <details class="creator-notes-details" id="creatorNotesDetails" style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 10px; border: 1px solid var(--glass-border);">
                                <summary style="cursor: pointer; font-weight: bold; color: var(--accent); display: flex; align-items: center; gap: 8px;">
                                    <i class="fa-solid fa-feather-pointed"></i> 
                                    <span style="flex: 1;">Creator's Notes</span>
                                    <button type="button" class="creator-notes-expand-btn" id="creatorNotesExpandBtn" title="View full screen">
                                        <i class="fa-solid fa-expand"></i>
                                    </button>
                                </summary>
                                <div id="modalCreatorNotes" class="scrolling-text" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--glass-border);"></div>
                            </details>
                        </div>

                        <div class="description-box">
                            <h3><i class="fa-solid fa-scroll" style="margin-right: 8px; opacity: 0.7;"></i>Description</h3>
                            <div id="modalDescription" class="scrolling-text"></div>
                        </div>
                        <div class="first-mes-box">
                            <div class="content-header">
                                <h3 class="expandable-section-title" id="firstMesTitleExpand" title="Click to expand"><i class="fa-solid fa-message" style="margin-right: 8px; opacity: 0.7;"></i>First Message</h3>
                            </div>
                            <div id="modalFirstMes" class="scrolling-text"></div>
                        </div>

                        <div class="alt-greetings-box" id="modalAltGreetingsBox" style="display:none; margin-top: 20px;">
                            <details id="altGreetingsDetails" style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 10px; border: 1px solid var(--glass-border);">
                                <summary style="cursor: pointer; font-weight: bold; color: var(--accent); display: flex; align-items: center; gap: 10px;">
                                    <span style="flex: 1;"><i class="fa-solid fa-comments" style="margin-right: 8px; opacity: 0.7;"></i>Alternate Greetings (<span id="altGreetingsCount">0</span>)</span>
                                    <button type="button" class="content-expand-btn" id="altGreetingsExpandBtn" title="Expand">
                                        <i class="fa-solid fa-expand"></i>
                                    </button>
                                </summary>
                                <div id="modalAltGreetings" class="scrolling-text" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--glass-border);"></div>
                            </details>
                        </div>

                        <div class="lorebook-box" id="modalLorebookBox" style="display:none; margin-top: 20px;">
                            <details style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 10px; border: 1px solid var(--glass-border);">
                                <summary style="cursor: pointer; font-weight: bold; color: var(--accent);"><i class="fa-solid fa-book"></i> Embedded Lorebook (<span id="lorebookEntryCount">0</span> entries)</summary>
                                <div id="modalLorebookContent" class="scrolling-text" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--glass-border);"></div>
                            </details>
                        </div>
                    </div>

                    <div class="tab-pane" id="pane-edit">
                        <div class="edit-lock-header">
                            <div class="lock-status" id="editLockStatus">
                                <i class="fa-solid fa-lock"></i>
                                <span>Fields are locked. Click unlock to edit.</span>
                            </div>
                            <div class="lock-header-actions">
                                <button type="button" id="toggleEditLockBtn" class="action-btn secondary small">
                                    <i class="fa-solid fa-lock-open"></i> <span class="btn-label">Unlock Editing</span>
                                </button>
                                <button type="button" id="editPaneVersionsBtn" class="action-btn secondary small" title="Version History">
                                    <i class="fa-solid fa-clock-rotate-left"></i> <span class="btn-label">Versions</span>
                                </button>
                            </div>
                        </div>

                        <div class="edit-section">
                            <h4 class="section-header"><i class="fa-solid fa-user"></i> Basic Information</h4>
                            <div class="form-group">
                                <label>Character Name</label>
                                <input type="text" id="editName" class="glass-input" autocomplete="off">
                            </div>
                            <div class="form-row">
                                <div class="form-group half">
                                    <label>Creator / Author</label>
                                    <input type="text" id="editCreator" class="glass-input" placeholder="Who made this character" autocomplete="off">
                                </div>
                                <div class="form-group half">
                                    <label>Character Version</label>
                                    <input type="text" id="editVersion" class="glass-input" placeholder="e.g., 1.0" autocomplete="off">
                                </div>
                            </div>
                        </div>

                        <div class="edit-section">
                            <h4 class="section-header"><i class="fa-solid fa-scroll"></i> Character Definition</h4>
                            <div class="form-group expandable-field">
                                <label>Description / Persona</label>
                                <button type="button" class="expand-field-btn hidden" data-field="editDescription" data-label="Description / Persona" title="Expand editor">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                                <textarea id="editDescription" class="glass-input" rows="5" placeholder="Who is this character?"></textarea>
                            </div>
                            <div class="form-group expandable-field">
                                <label>Personality Summary</label>
                                <button type="button" class="expand-field-btn hidden" data-field="editPersonality" data-label="Personality Summary" title="Expand editor">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                                <textarea id="editPersonality" class="glass-input" rows="3" placeholder="Brief personality traits..."></textarea>
                            </div>
                            <div class="form-group expandable-field">
                                <label>Scenario / Setting</label>
                                <button type="button" class="expand-field-btn hidden" data-field="editScenario" data-label="Scenario / Setting" title="Expand editor">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                                <textarea id="editScenario" class="glass-input" rows="3" placeholder="The current situation..."></textarea>
                            </div>
                        </div>

                        <div class="edit-section">
                            <h4 class="section-header">
                                <i class="fa-solid fa-comments"></i> Messages
                                <button type="button" id="expandGreetingsBtn" class="section-expand-btn hidden" title="Edit all greetings in expanded view">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                            </h4>
                            <div class="form-group">
                                <label>First Message</label>
                                <textarea id="editFirstMes" class="glass-input" rows="5" placeholder="Opening message from the character..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Alternate Greetings <span class="label-hint">(one per text box)</span></label>
                                <div id="altGreetingsEditContainer" class="alt-greetings-container">
                                    <!-- Dynamically populated -->
                                </div>
                                <button type="button" id="addAltGreetingBtn" class="action-btn secondary small" style="margin-top: 10px;">
                                    <i class="fa-solid fa-plus"></i> Add Greeting
                                </button>
                            </div>
                            <div class="form-group expandable-field">
                                <label>Example Dialogue <span class="label-hint">(for training context)</span></label>
                                <button type="button" class="expand-field-btn hidden" data-field="editMesExample" data-label="Example Dialogue" title="Expand editor">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                                <textarea id="editMesExample" class="glass-input" rows="5" placeholder="{{user}}: Hello!\n{{char}}: *waves* Hi there!"></textarea>
                            </div>
                        </div>

                        <div class="edit-section">
                            <h4 class="section-header"><i class="fa-solid fa-wand-magic-sparkles"></i> Advanced (Prompt Overrides)</h4>
                            <div class="form-group expandable-field">
                                <label>System Prompt <span class="label-hint">(Main Prompt Override)</span></label>
                                <button type="button" class="expand-field-btn hidden" data-field="editSystemPrompt" data-label="System Prompt" title="Expand editor">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                                <textarea id="editSystemPrompt" class="glass-input" rows="4" placeholder="Overrides your default system prompt..."></textarea>
                            </div>
                            <div class="form-group expandable-field">
                                <label>Post-History Instructions <span class="label-hint">(Jailbreak)</span></label>
                                <button type="button" class="expand-field-btn hidden" data-field="editPostHistoryInstructions" data-label="Post-History Instructions" title="Expand editor">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                                <textarea id="editPostHistoryInstructions" class="glass-input" rows="4" placeholder="Instructions placed after chat history..."></textarea>
                            </div>
                            <div class="form-group expandable-field">
                                <label>Creator's Notes <span class="label-hint">(For users, not sent to AI)</span></label>
                                <button type="button" class="expand-field-btn hidden" data-field="editCreatorNotes" data-label="Creator's Notes" title="Expand editor">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                                <textarea id="editCreatorNotes" class="glass-input" rows="4" placeholder="Tips, warnings, or info for users..."></textarea>
                            </div>
                        </div>

                        <div class="edit-section lorebook-edit-section">
                            <h4 class="section-header">
                                <i class="fa-solid fa-book"></i> Embedded Lorebook
                                <span id="lorebookEditCount" class="lorebook-count">(0 entries)</span>
                                <button type="button" id="expandLorebookBtn" class="section-expand-btn hidden" title="Edit lorebook in expanded view">
                                    <i class="fa-solid fa-expand"></i>
                                </button>
                            </h4>
                            <details id="lorebookEditDetails">
                                <summary class="lorebook-toggle-summary">
                                    <i class="fa-solid fa-chevron-down expand-icon"></i>
                                    <span>Show/Hide Entries</span>
                                </summary>
                                <div class="lorebook-edit-content">
                                    <div id="lorebookEntriesEdit" class="lorebook-entries-container">
                                        <!-- Dynamically populated -->
                                    </div>
                                    <button type="button" id="addLorebookEntryBtn" class="action-btn secondary small" style="margin-top: 10px;">
                                        <i class="fa-solid fa-plus"></i> Add Entry
                                    </button>
                                </div>
                            </details>
                        </div>

                        <div class="form-actions" id="editFormActions">
                            <button id="cancelEditBtn" class="action-btn secondary" style="display: none;"><i class="fa-solid fa-times"></i> Cancel</button>
                            <button id="saveEditBtn" class="action-btn primary" disabled><i class="fa-solid fa-save"></i> Save Changes</button>
                        </div>
                    </div>

                    <div class="tab-pane" id="pane-chats">
                        <div class="chats-header">
                            <h4><i class="fa-solid fa-message"></i> Chat History</h4>
                            <div class="chats-actions">
                                <button id="newChatBtn" class="action-btn secondary small"><i class="fa-solid fa-plus"></i> New Chat</button>
                                <button id="refreshChatsBtn" class="action-btn secondary small"><i class="fa-solid fa-refresh"></i></button>
                            </div>
                        </div>
                        <div class="chats-list" id="chatsList">
                            <div class="chats-loading"><i class="fa-solid fa-spinner fa-spin"></i> Loading chats...</div>
                        </div>
                    </div>

                    <div class="tab-pane" id="pane-gallery">
                        <div class="gallery-header">
                            <h4><i class="fa-solid fa-images"></i> Character Library</h4>
                            <div class="gallery-actions">
                                <div id="checkLegacyFolderBtn" class="legacy-indicator hidden" title="Legacy images found">
                                    <span id="legacyFolderCount"></span>
                                </div>
                                <button id="localizeMediaBtn" class="action-btn secondary small" title="Download remote images from character card">
                                    <i class="fa-solid fa-download"></i> Download Media
                                </button>
                                <label class="localize-toggle" title="Replace remote URLs with local files when viewing this character">
                                    <input type="checkbox" id="charLocalizeToggle">
                                    <span class="localize-toggle-label"><i class="fa-solid fa-link-slash"></i> Use Local Media</span>
                                </label>
                            </div>
                        </div>
                        <div class="gallery-id-warning hidden" id="galleryIdWarning">
                            <div class="gallery-id-warning-content">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                                <div class="gallery-id-warning-text">
                                    <strong>No Gallery ID assigned</strong>
                                    <span>This character doesn't have a unique gallery ID. Without one, characters with the same name will share a gallery folder.</span>
                                </div>
                                <button id="assignGalleryIdBtn" class="action-btn secondary small" title="Assign a unique gallery ID to this character">
                                    <i class="fa-solid fa-fingerprint"></i> Assign ID
                                </button>
                            </div>
                        </div>
                        <div class="gallery-sprites-grid" id="spritesGrid">
                            <!-- User images for this character -->
                        </div>
                        <div class="upload-zone" id="uploadZone">
                            <i class="fa-solid fa-cloud-upload"></i> Drop images here to add to gallery
                            <input type="file" id="imageUploadInput" multiple accept="image/*" style="display: none;">
                        </div>
                    </div>

                    <div class="tab-pane" id="pane-related">
                        <div class="related-header">
                            <h4><i class="fa-solid fa-diagram-project"></i> Related Characters</h4>
                            <div class="related-info">
                                <i class="fa-solid fa-info-circle"></i>
                                <span>Characters that may share the same universe, creator, or themes</span>
                            </div>
                        </div>
                        <div class="related-filters">
                            <label class="related-filter-toggle">
                                <input type="checkbox" id="relatedFilterTags" checked>
                                <span><i class="fa-solid fa-tags"></i> Shared Tags</span>
                            </label>
                            <label class="related-filter-toggle">
                                <input type="checkbox" id="relatedFilterCreator" checked>
                                <span><i class="fa-solid fa-user-pen"></i> Same Creator</span>
                            </label>
                            <label class="related-filter-toggle">
                                <input type="checkbox" id="relatedFilterContent" checked>
                                <span><i class="fa-solid fa-file-lines"></i> Content Similarity</span>
                            </label>
                        </div>
                        <div class="related-results" id="relatedResults">
                            <div class="related-loading"><i class="fa-solid fa-spinner fa-spin"></i> Finding related characters...</div>
                        </div>
                    </div>

                    <!-- Versions Tab -->
                    <div class="tab-pane" id="pane-versions">
                        <div id="versionsTabContent">
                            <!-- Populated by character-versions.js module -->
                        </div>
                    </div>

                    <!-- Info Tab (Developer) -->
                    <div class="tab-pane" id="pane-info">
                        <div class="info-tab-header">
                            <h4><i class="fa-solid fa-microscope"></i> Card Metadata & Mappings</h4>
                            <p class="info-tab-desc">Debug information for this character card</p>
                        </div>
                        <div class="info-tab-content" id="infoTabContent">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ChubAI Link Modal -->
    <div id="chubLinkModal" class="confirm-modal hidden">
        <div class="confirm-modal-content chub-link-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-link"></i> <span id="chubLinkModalTitle">ChubAI Link</span></h3>
                <button class="close-confirm-btn" id="closeChubLinkModal">&times;</button>
            </div>
            <div class="confirm-modal-body chub-link-modal-body">
                <!-- Character sidebar with avatar -->
                <div class="chub-link-sidebar">
                    <div class="chub-link-avatar-wrapper">
                        <img id="chubLinkCharAvatar" class="chub-link-avatar" src="" alt="Character">
                        <div id="chubLinkStatusIcon" class="chub-link-status-icon unlinked">
                            <i class="fa-solid fa-link-slash"></i>
                        </div>
                    </div>
                    <div class="chub-link-char-name" id="chubLinkCharName">Character</div>
                </div>
                
                <!-- Main content area -->
                <div class="chub-link-main">
                    <!-- Linked State -->
                    <div id="chubLinkLinkedState" class="chub-link-state hidden">
                        <a id="chubLinkCurrentPath" href="#" target="_blank" class="chub-link-current-path">
                            <i class="fa-solid fa-external-link-alt"></i>
                            <span></span>
                        </a>
                        
                        <!-- Quick stats from linked character -->
                        <div id="chubLinkStats" class="chub-link-stats">
                            <span><i class="fa-solid fa-download"></i> <span id="chubLinkStars">-</span></span>
                            <span><i class="fa-solid fa-heart"></i> <span id="chubLinkFavorites">-</span></span>
                            <span><i class="fa-solid fa-coins"></i> <span id="chubLinkTokens">-</span></span>
                        </div>
                        
                        <div class="chub-link-actions">
                            <button id="chubLinkViewInGalleryBtn" class="chub-link-btn primary">
                                <i class="fa-solid fa-eye"></i> View on ChubAI
                            </button>
                            <button id="chubLinkGalleryBtn" class="chub-link-btn secondary">
                                <i class="fa-solid fa-images"></i> Download Gallery
                            </button>
                            <button id="chubLinkVersionsBtn" class="chub-link-btn secondary">
                                <i class="fa-solid fa-clock-rotate-left"></i> Version History
                            </button>
                            <button id="chubLinkUnlinkBtn" class="chub-link-btn text-danger">
                                <i class="fa-solid fa-unlink"></i> Unlink
                            </button>
                        </div>
                    </div>
                    
                    <!-- Unlinked State -->
                    <div id="chubLinkUnlinkedState" class="chub-link-state">
                        <div class="chub-link-search-section">
                            <div class="chub-link-search-row">
                                <input type="text" id="chubLinkSearchName" class="glass-input" placeholder="Character name" autocomplete="off">
                                <span class="chub-link-search-by">by</span>
                                <input type="text" id="chubLinkSearchCreator" class="glass-input" placeholder="Creator" autocomplete="off">
                                <button id="chubLinkSearchBtn" class="chub-link-search-btn" title="Search">
                                    <i class="fa-solid fa-search"></i>
                                </button>
                            </div>
                            <div id="chubLinkSearchResults" class="chub-link-search-results"></div>
                        </div>
                        
                        <div class="chub-link-divider"><span>or paste URL</span></div>
                        
                        <div class="chub-link-url-row">
                            <input type="text" id="chubLinkUrlInput" class="glass-input" placeholder="https://chub.ai/characters/..." autocomplete="off">
                            <button id="chubLinkUrlBtn" class="chub-link-btn primary compact">
                                <i class="fa-solid fa-link"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Summary Modal -->
    <div id="importSummaryModal" class="confirm-modal hidden">
        <div class="confirm-modal-content chub-gallery-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-circle-info"></i> Additional Content Available</h3>
                <button class="close-confirm-btn" id="closeImportSummaryModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <p>The imported character(s) have additional content:</p>
                <div id="importSummaryList" class="import-summary-list">
                    <!-- Row for Embedded Media (first - takes precedence) -->
                    <div id="importSummaryMediaRow" class="import-summary-row hidden">
                        <div class="import-summary-row-icon">
                            <i class="fa-solid fa-photo-film"></i>
                        </div>
                        <div class="import-summary-row-info">
                            <span class="import-summary-row-title">Embedded Remote Media</span>
                            <span id="importSummaryMediaDesc" class="import-summary-row-desc">Remote files that can be saved locally</span>
                        </div>
                    </div>
                    
                    <!-- Row for ChubAI Gallery (second) -->
                    <div id="importSummaryGalleryRow" class="import-summary-row hidden">
                        <div class="import-summary-row-icon">
                            <i class="fa-solid fa-images"></i>
                        </div>
                        <div class="import-summary-row-info">
                            <span class="import-summary-row-title">ChubAI Gallery Images</span>
                            <span id="importSummaryGalleryDesc" class="import-summary-row-desc">Additional artwork available on ChubAI</span>
                        </div>
                    </div>
                </div>
                <div id="importSummaryProgress" class="import-summary-progress hidden">
                    <div class="import-summary-progress-header">
                        <span id="importSummaryProgressLabel">Preparing downloads...</span>
                        <span id="importSummaryProgressCount">0/0</span>
                    </div>
                    <div class="import-summary-progress-bar">
                        <div id="importSummaryProgressFill" class="import-summary-progress-fill"></div>
                    </div>
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="importSummaryDownloadAllBtn" class="action-btn download-all-btn"><i class="fa-solid fa-cloud-arrow-down"></i> Download All</button>
            </div>
        </div>
    </div>

    <!-- Import Characters Modal -->
    <div id="importModal" class="confirm-modal hidden">
        <div class="confirm-modal-content import-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-download"></i> Import Characters</h3>
                <button class="close-confirm-btn" id="closeImportModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <!-- Import source toggle -->
                <div class="import-source-toggle">
                    <button class="import-source-btn active" data-source="chub">
                        <i class="fa-solid fa-link"></i> Chub URLs
                    </button>
                    <button class="import-source-btn" data-source="local">
                        <i class="fa-solid fa-file-image"></i> Local PNG
                    </button>
                </div>

                <!-- Chub URL input (default) -->
                <div id="importSourceChub" class="import-source-panel">
                    <p>Paste Chub AI character URLs below (one per line):</p>
                    <textarea id="importUrlsInput" class="glass-input import-urls-textarea" placeholder="https://chub.ai/characters/author/character-name
https://chub.ai/characters/author/another-character
..."></textarea>
                </div>

                <!-- Local PNG input -->
                <div id="importSourceLocal" class="import-source-panel hidden">
                    <p>Select or drag &amp; drop character card PNG files:</p>
                    <div id="importDropZone" class="import-drop-zone">
                        <input type="file" id="importFileInput" multiple accept=".png" class="import-file-input">
                        <div class="import-drop-placeholder" id="importDropPlaceholder">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <span>Drag &amp; drop PNG files here</span>
                            <button type="button" class="import-browse-btn">Browse Files</button>
                        </div>
                        <div class="import-file-list hidden" id="importFileList"></div>
                    </div>
                    <div class="import-file-count hidden" id="importFileCount">
                        <span id="importFileCountText">0 files selected</span>
                        <button type="button" class="import-clear-files-btn" id="importClearFiles" title="Clear all files">
                            <i class="fa-solid fa-trash-can"></i> Clear
                        </button>
                    </div>
                </div>

                <div class="import-options">
                    <label class="import-option-toggle">
                        <input type="checkbox" id="importSkipDuplicates" checked>
                        <span>Skip duplicates <span class="import-option-hint">(already in library)</span></span>
                    </label>
                    <label class="import-option-toggle" id="importGalleryOption">
                        <input type="checkbox" id="importAutoDownloadGallery">
                        <span>Auto-download gallery</span>
                    </label>
                    <label class="import-option-toggle">
                        <input type="checkbox" id="importAutoDownloadMedia">
                        <span>Auto-download embedded media</span>
                    </label>
                </div>
                <div class="import-info" id="importInfoHint">
                    <i class="fa-solid fa-info-circle"></i>
                    <span>Supports chub.ai and characterhub.org links. Characters will be imported as PNG files.</span>
                </div>
                <div id="importProgress" class="import-progress hidden">
                    <div class="import-progress-header">
                        <span>Importing characters...</span>
                        <span id="importProgressCount">0/0</span>
                    </div>
                    <div class="import-progress-bar">
                        <div id="importProgressFill" class="import-progress-fill"></div>
                    </div>
                    <div id="importMediaProgress" class="import-media-progress hidden">
                        <div class="import-progress-header">
                            <span>Downloading media...</span>
                            <span id="importMediaProgressCount">0/0</span>
                        </div>
                        <div class="import-progress-bar">
                            <div id="importMediaProgressFill" class="import-progress-fill"></div>
                        </div>
                    </div>
                    <div id="importStats" class="import-stats hidden">
                        <div class="stat-item" title="Characters imported"><i class="fa-solid fa-user-plus"></i> <span id="importStatImported">0</span> imported</div>
                        <div class="stat-item" title="Characters skipped (duplicates)"><i class="fa-solid fa-forward"></i> <span id="importStatSkipped">0</span> skipped</div>
                        <div class="stat-item" title="Media files downloaded"><i class="fa-solid fa-download"></i> <span id="importStatMedia">0</span> media</div>
                        <div class="stat-item" title="Errors"><i class="fa-solid fa-xmark"></i> <span id="importStatErrors">0</span> errors</div>
                    </div>
                    <div id="importLog" class="import-log"></div>
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="startImportBtn" class="action-btn primary"><i class="fa-solid fa-download"></i> Import</button>
            </div>
        </div>
    </div>

    <!-- Localize Media Modal -->
    <div id="localizeModal" class="confirm-modal hidden">
        <div class="confirm-modal-content import-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-download"></i> Download Remote Media</h3>
                <button class="close-confirm-btn" id="closeLocalizeModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <p id="localizeStatus">Scanning character for remote media...</p>
                <div id="localizeProgress" class="import-progress">
                    <div class="import-progress-header">
                        <span>Downloading media...</span>
                        <span id="localizeProgressCount">0/0</span>
                    </div>
                    <div class="import-progress-bar">
                        <div id="localizeProgressFill" class="import-progress-fill"></div>
                    </div>
                    <div id="localizeLog" class="import-log"></div>
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="closeLocalizeBtn" class="action-btn secondary"><i class="fa-solid fa-times"></i> Close</button>
            </div>
        </div>
    </div>

    <!-- Bulk Localize Media Modal -->
    <div id="bulkLocalizeModal" class="confirm-modal hidden">
        <div class="confirm-modal-content import-modal-content bulk-localize-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-download"></i> Bulk Media Localization</h3>
                <button class="close-confirm-btn" id="closeBulkLocalizeModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <div id="bulkLocalizeCharInfo" class="bulk-localize-char-info">
                    <img id="bulkLocalizeCharAvatar" src="" alt="">
                    <span id="bulkLocalizeCharName">Preparing...</span>
                </div>
                <p id="bulkLocalizeStatus">Scanning library...</p>
                <div id="bulkLocalizeProgress" class="import-progress">
                    <div class="import-progress-header">
                        <span>Overall Progress</span>
                        <span id="bulkLocalizeProgressCount">0/0 characters</span>
                    </div>
                    <div class="import-progress-bar">
                        <div id="bulkLocalizeProgressFill" class="import-progress-fill"></div>
                    </div>
                    <div class="import-progress-header" style="margin-top: 10px;">
                        <span>Current Character</span>
                        <span id="bulkLocalizeFileCount">0/0 files</span>
                    </div>
                    <div class="import-progress-bar">
                        <div id="bulkLocalizeFileFill" class="import-progress-fill"></div>
                    </div>
                </div>
                <div id="bulkLocalizeStats" class="bulk-localize-stats">
                    <div class="stat-item" title="New media files downloaded to gallery"><i class="fa-solid fa-download"></i> <span id="bulkStatDownloaded">0</span> downloaded</div>
                    <div class="stat-item" title="Files already exist locally (matched by content hash)"><i class="fa-solid fa-forward"></i> <span id="bulkStatSkipped">0</span> skipped</div>
                    <div class="stat-item" title="Downloads that failed"><i class="fa-solid fa-xmark"></i> <span id="bulkStatErrors">0</span> errors</div>
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="cancelBulkLocalizeBtn" class="action-btn secondary"><i class="fa-solid fa-stop"></i> Stop</button>
            </div>
        </div>
    </div>

    <!-- Bulk Localize Summary Modal -->
    <div id="bulkLocalizeSummaryModal" class="confirm-modal hidden">
        <div class="confirm-modal-content bulk-summary-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-chart-bar"></i> Bulk Localization Complete</h3>
                <button class="close-confirm-btn" id="closeBulkSummaryModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <div id="bulkSummaryOverview" class="bulk-summary-overview">
                    <!-- Overview stats go here -->
                </div>
                <div id="bulkSummaryFilter" class="bulk-summary-filter">
                    <label>Show:</label>
                    <select id="bulkSummaryFilterSelect" class="glass-select">
                        <option value="all" data-icon="fa-solid fa-list">All Characters</option>
                        <option value="localized" data-icon="fa-solid fa-circle-check">Fully Localized</option>
                        <option value="downloaded" data-icon="fa-solid fa-download">With Downloads</option>
                        <option value="skipped" data-icon="fa-solid fa-forward">With Skipped</option>
                        <option value="errors" data-icon="fa-solid fa-triangle-exclamation">With Errors</option>
                        <option value="incomplete" data-icon="fa-solid fa-circle-half-stroke">Incomplete (Errors/Stopped)</option>
                        <option value="none" data-icon="fa-solid fa-circle-xmark">No Remote Media</option>
                    </select>
                    <input type="text" id="bulkSummarySearch" class="glass-input" placeholder="Search character...">
                </div>
                <div id="bulkSummaryList" class="bulk-summary-list">
                    <!-- Per-character results go here -->
                </div>
                <div id="bulkSummaryPagination" class="bulk-summary-pagination">
                    <button id="bulkSummaryPrevBtn" class="glass-btn icon-only"><i class="fa-solid fa-chevron-left"></i></button>
                    <span id="bulkSummaryPageInfo">Page 1 of 1</span>
                    <button id="bulkSummaryNextBtn" class="glass-btn icon-only"><i class="fa-solid fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="closeBulkSummaryBtn" class="action-btn primary"><i class="fa-solid fa-check"></i> Done</button>
            </div>
        </div>
    </div>

    <!-- Bulk ChubAI Link Modal -->
    <div id="bulkChubLinkModal" class="confirm-modal hidden">
        <div class="confirm-modal-content bulk-chub-link-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-link"></i> Link Characters to ChubAI</h3>
                <button class="close-confirm-btn" id="closeBulkChubLinkModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <!-- Scanning Phase -->
                <div id="bulkChubLinkScanning" class="bulk-chub-link-phase">
                    <div class="bulk-chub-link-scan-info">
                        <img id="bulkChubLinkScanAvatar" src="" alt="">
                        <span id="bulkChubLinkScanName">Preparing...</span>
                    </div>
                    <p id="bulkChubLinkScanStatus">Scanning library for unlinked characters...</p>
                    <div class="import-progress">
                        <div class="import-progress-header">
                            <span>Progress</span>
                            <span id="bulkChubLinkScanProgress">0/0</span>
                        </div>
                        <div class="import-progress-bar">
                            <div id="bulkChubLinkScanFill" class="import-progress-fill"></div>
                        </div>
                    </div>
                    <div class="bulk-chub-link-scan-stats">
                        <span><i class="fa-solid fa-check-circle"></i> <span id="bulkChubLinkConfidentCount">0</span> confident</span>
                        <span><i class="fa-solid fa-question-circle"></i> <span id="bulkChubLinkUncertainCount">0</span> need review</span>
                        <span><i class="fa-solid fa-times-circle"></i> <span id="bulkChubLinkNoMatchCount">0</span> no match</span>
                    </div>
                </div>
                
                <!-- Results Phase -->
                <div id="bulkChubLinkResults" class="bulk-chub-link-phase hidden">
                    <div class="bulk-chub-link-tabs">
                        <button class="bulk-chub-link-tab active" data-tab="confident" onclick="switchBulkChubLinkTab('confident')">
                            <i class="fa-solid fa-check-circle"></i> Confident (<span id="bulkChubLinkConfidentTabCount">0</span>)
                        </button>
                        <button class="bulk-chub-link-tab" data-tab="uncertain" onclick="switchBulkChubLinkTab('uncertain')">
                            <i class="fa-solid fa-question-circle"></i> Needs Review (<span id="bulkChubLinkUncertainTabCount">0</span>)
                        </button>
                        <button class="bulk-chub-link-tab" data-tab="nomatch" onclick="switchBulkChubLinkTab('nomatch')">
                            <i class="fa-solid fa-times-circle"></i> No Match (<span id="bulkChubLinkNoMatchTabCount">0</span>)
                        </button>
                    </div>
                    <div class="bulk-chub-link-actions" id="bulkChubLinkConfidentActions">
                        <button class="action-btn small secondary" onclick="bulkChubLinkSelectAll()"><i class="fa-solid fa-check-double"></i> Select All</button>
                        <button class="action-btn small secondary" onclick="bulkChubLinkDeselectAll()"><i class="fa-solid fa-square"></i> Deselect All</button>
                    </div>
                    <div class="bulk-chub-link-list-container">
                        <div id="bulkChubLinkConfidentList" class="bulk-chub-link-list"></div>
                        <div id="bulkChubLinkUncertainList" class="bulk-chub-link-list" style="display: none;"></div>
                        <div id="bulkChubLinkNoMatchList" class="bulk-chub-link-list" style="display: none;"></div>
                    </div>
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="bulkChubLinkCancelBtn" class="action-btn secondary"><i class="fa-solid fa-stop"></i> Stop</button>
                <button id="bulkChubLinkApplyBtn" class="action-btn primary hidden"><i class="fa-solid fa-link"></i> Link Selected (<span id="bulkChubLinkSelectedCount">0</span>)</button>
            </div>
        </div>
    </div>

    <!-- Help & Tips Modal -->
    <div id="galleryInfoModal" class="confirm-modal hidden">
        <div class="confirm-modal-content gallery-info-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-circle-info"></i> Help & Tips</h3>
                <button class="close-confirm-btn" id="closeGalleryInfoModal">&times;</button>
            </div>
            <div class="confirm-modal-body gallery-info-body">
                
                <div class="info-section">
                    <h4><i class="fa-solid fa-magnifying-glass"></i> Search Filters</h4>
                    <p>Use special search prefixes to filter your character library:</p>
                    <div class="info-code-list">
                        <div class="info-code-item">
                            <code>creator:name</code>
                            <span>Filter by author/creator name</span>
                        </div>
                        <div class="info-code-item">
                            <code>chub:yes</code> / <code>chub:no</code>
                            <span>Filter characters linked/not linked to ChubAI</span>
                        </div>
                        <div class="info-code-item">
                            <code>favorite:yes</code> / <code>fav:no</code>
                            <span>Filter by favorite status</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-clock-rotate-left"></i> Version History</h4>
                    <p>Track changes to your character cards with snapshots and diffs:</p>
                    <ul>
                        <li><strong>Auto-backup:</strong> A snapshot is saved automatically before every edit, restore, or card update, so you can always undo</li>
                        <li><strong>Manual snapshots:</strong> Save the current state of any character at any time</li>
                        <li><strong>Diff preview:</strong> Side-by-side comparison for every card field with added/removed highlighting</li>
                        <li><strong>Remote versions:</strong> For ChubAI-linked characters, browse the full published version history and restore any version</li>
                    </ul>
                    <p><strong>How remote versions work:</strong></p>
                    <ul>
                        <li><strong>"Chub Page" entry</strong>, shows the current state on ChubAI. Uses the metadata API for card fields, but when a linked lorebook project exists the lorebook is fetched from the V4 Git API and merged in. We use the metadata API here because the V4 Git API has data issues with some characters.</li>
                        <li><strong>Git version history</strong>, each commit is fetched directly from the V4 Git API (<code>card.json</code>). These are the actual exported snapshots including the full merged lorebook.</li>
                    </ul>
                    <p class="info-tip"><i class="fa-solid fa-lightbulb"></i> Configure max auto-backup count in Settings ‚Üí Version History.</p>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-link"></i> ChubAI Linking</h4>
                    <p>Link your local characters to their ChubAI source for extra features:</p>
                    <ul>
                        <li><strong>Card Updates:</strong> Check for and apply field-level updates from ChubAI with diff preview</li>
                        <li><strong>Gallery Downloads:</strong> Download character gallery images from ChubAI</li>
                        <li><strong>Version History:</strong> Browse the full published version history from ChubAI</li>
                        <li><strong>Quick Navigation:</strong> Jump to the ChubAI page from character details</li>
                        <li><strong>Bulk Linking:</strong> Use "Link ChubAI Characters" to auto-match by name, creator, and content similarity</li>
                    </ul>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-book-bookmark"></i> Lorebooks & Card Updates</h4>
                    <p>When a character card includes a lorebook (World Info), SillyTavern stores it in two places:</p>
                    <ul>
                        <li><strong>Embedded lorebook</strong> (inside the card), created at import time. SillyTavern does not modify this copy when you edit entries in the World Info editor.</li>
                        <li><strong>World Info file</strong> (in <code>/worlds/</code>), the live working copy that SillyTavern uses in chats. All edits you make in the World Info panel go here.</li>
                    </ul>
                    <p>These two copies are <strong>independent</strong> and diverge after import.</p>

                    <p><strong>How ChubAI stores lorebooks (it's messy):</strong></p>
                    <p>ChubAI has two ways a character can have lorebook entries:</p>
                    <ul>
                        <li><strong>Embedded entries</strong>, baked directly into the card definition and returned by the metadata API</li>
                        <li><strong>Linked lorebook</strong>, a separate lorebook project attached to the character. ChubAI merges these entries into the card when you export/download it, but the metadata API returns them separately (or sometimes partially)</li>
                    </ul>
                    <p>The metadata API can return incomplete lorebook data. For example, only the embedded entries while the linked lorebook project has dozens more. The V4 Git API (which serves the actual exported <code>card.json</code>) returns the fully merged result with all entries.</p>
                    <p>Character Library always resolves linked lorebooks: when a character has a linked lorebook project, we fetch the full merged lorebook from the V4 Git API regardless of which API source is used for other fields. This ensures update checks and imports always see the complete lorebook.</p>

                    <p><strong>What happens during a card update check:</strong></p>
                    <ul>
                        <li>Character Library compares the card's <strong>embedded lorebook</strong> against the creator's latest version on ChubAI (with linked lorebook entries resolved)</li>
                        <li>New entries, modified entries, and entries only in your card (local-only) are shown in the diff</li>
                        <li>Your World Info file is <strong>never modified</strong> by the update checker</li>
                    </ul>
                    <p><strong>What happens when you apply a lorebook update:</strong></p>
                    <ul>
                        <li>The card's embedded lorebook is replaced with the latest version from ChubAI</li>
                        <li>Local-only entries (in your card but not on ChubAI) will be removed from the embedded copy</li>
                        <li>Your World Info file is <strong>not touched</strong>. It keeps all your entries and edits as-is</li>
                    </ul>
                    <p><strong>Safety check for local-only entries:</strong></p>
                    <ul>
                        <li>For entries that would be removed from the card, Character Library checks whether they also exist in your World Info file</li>
                        <li><i class="fa-solid fa-shield-halved" style="color:#81c784;"></i> <strong>Safe</strong>, the entry also exists in your World Info file, so removing it from the card won't affect your chats</li>
                        <li><i class="fa-solid fa-triangle-exclamation" style="color:#ffb74d;"></i> <strong>Warning</strong>, the entry was not found in your World Info file and will be permanently lost after applying</li>
                    </ul>
                    <p class="info-tip"><i class="fa-solid fa-lightbulb"></i> <strong>TL;DR:</strong> Updates only change the card's embedded data. Your World Info file (the copy that actually matters for chats) is never modified. Linked lorebooks from ChubAI are always resolved to the full merged version.</p>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-images"></i> Media Localization</h4>
                    <p>Download embedded remote images and reference them dynamically:</p>
                    <ul>
                        <li>Preserves images if the original host goes offline</li>
                        <li>Downloads gallery images from linked ChubAI characters</li>
                        <li>Deduplication by image hash</li>
                        <li>URL replacement uses the original filename to match local files</li>
                        <li>Some hosts require SillyTavern's <strong>CORS Proxy</strong> to be enabled (User Settings ‚Üí Network)</li>
                    </ul>
                    <p class="info-tip"><i class="fa-solid fa-lightbulb"></i> Enable "Replace remote media URLs" in Settings to auto-swap URLs when viewing. Use Bulk Localization in Settings to process your entire library at once.</p>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-clone"></i> Duplicate Detection</h4>
                    <p>The duplicate scanner compares character content to find potential duplicates:</p>
                    <ul>
                        <li>Compares character name, creator, description, tags, and lorebook entries</li>
                        <li>Shows a similarity score (0-100%) for each match</li>
                        <li>Higher scores indicate closer matches</li>
                        <li>Review and manage duplicates to keep your library organized</li>
                    </ul>
                    <p class="info-tip"><i class="fa-solid fa-lightbulb"></i> Adjust the minimum score threshold in Settings to see more or fewer matches.</p>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-list-check"></i> Multi-Select & Batch Operations</h4>
                    <p>Select multiple characters for bulk actions:</p>
                    <ul>
                        <li>Press <code>Space</code> or click the multi-select button to enter selection mode</li>
                        <li>Click characters to select/deselect them</li>
                        <li><strong>Batch Tagging:</strong> Add or remove tags across all selected characters</li>
                        <li><strong>Batch Delete:</strong> Remove multiple characters at once</li>
                        <li>Press <code>Escape</code> to exit multi-select mode</li>
                    </ul>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-keyboard"></i> Keyboard Shortcuts</h4>
                    <div class="info-code-list">
                        <div class="info-code-item">
                            <code>Space</code>
                            <span>Toggle multi-select mode (character grid)</span>
                        </div>
                        <div class="info-code-item">
                            <code>Escape</code>
                            <span>Close modals, exit multi-select mode</span>
                        </div>
                        <div class="info-code-item">
                            <code>Page Up / Page Down</code>
                            <span>Scroll through character list</span>
                        </div>
                        <div class="info-code-item">
                            <code>Home / End</code>
                            <span>Scroll to top / bottom of character list</span>
                        </div>
                        <div class="info-code-item">
                            <code>‚Üê / ‚Üí</code>
                            <span>Navigate images in gallery viewer</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-tags"></i> Tag Management</h4>
                    <p>Click tags in the filter panel to cycle through states:</p>
                    <ul>
                        <li><span class="tag-state-example include">Green</span> - Include characters with this tag</li>
                        <li><span class="tag-state-example exclude">Red</span> - Exclude characters with this tag</li>
                        <li><span class="tag-state-example neutral">Gray</span> - Neutral (no filter)</li>
                    </ul>
                </div>

                <div class="info-section">
                    <h4><i class="fa-solid fa-hand-pointer"></i> Quick Actions</h4>
                    <ul>
                        <li><strong>Right-click</strong> any character card for a context menu with quick actions</li>
                        <li><strong>Import local PNGs</strong> via the import dialog (not just ChubAI URLs)</li>
                        <li><strong>Chats view</strong> lets you browse all chat histories across characters with AI model badges</li>
                        <li>On mobile: <strong>tap the avatar</strong> in the modal header for a full-size quick-view</li>
                        <li>On mobile: <strong>swipe left/right</strong> on character details to switch between tabs</li>
                        <li>On mobile: <strong>swipe left/right</strong> to cycle alternate greetings</li>
                    </ul>
                </div>

            </div>
            <div class="confirm-modal-footer">
                <button id="closeGalleryInfoModalBtn" class="action-btn secondary"><i class="fa-solid fa-check"></i> Got it</button>
            </div>
        </div>
    </div>

    <!-- Character Duplicates Scan Modal -->
    <div id="charDuplicatesModal" class="confirm-modal hidden">
        <div class="confirm-modal-content char-duplicates-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-clone"></i> Character Duplicates</h3>
                <button class="close-confirm-btn" id="closeCharDuplicatesModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <div id="charDuplicatesScanStatus" class="char-duplicates-status">
                    <i class="fa-solid fa-spinner fa-spin"></i> Scanning library for duplicates...
                </div>
                <div id="charDuplicatesResults" class="char-duplicates-results">
                    <!-- Duplicate groups will be populated here -->
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="closeCharDuplicatesModalBtn" class="action-btn secondary"><i class="fa-solid fa-check"></i> Done</button>
            </div>
        </div>
    </div>

    <!-- Pre-Import Duplicate Warning Modal -->
    <div id="preImportDuplicateModal" class="confirm-modal hidden">
        <div class="confirm-modal-content pre-import-duplicate-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-exclamation-triangle"></i> Potential Duplicate Found</h3>
                <button class="close-confirm-btn" id="closePreImportDuplicateModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <div id="preImportDuplicateInfo" class="pre-import-info">
                    <!-- Import character info -->
                </div>
                <div id="preImportDuplicateMatches" class="pre-import-matches">
                    <!-- Existing matches will be populated here -->
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="preImportSkipBtn" class="action-btn secondary"><i class="fa-solid fa-ban"></i> Skip Import</button>
                <button id="preImportAnyway" class="action-btn secondary"><i class="fa-solid fa-plus"></i> Import Anyway</button>
                <button id="preImportReplaceBtn" class="action-btn primary"><i class="fa-solid fa-rotate"></i> Replace Existing</button>
            </div>
        </div>
    </div>

    <!-- Save Confirmation Modal -->
    <div id="confirmSaveModal" class="confirm-modal hidden">
        <div class="confirm-modal-content">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-clipboard-check"></i> Confirm Changes</h3>
                <button class="close-confirm-btn" id="closeConfirmModal">&times;</button>
            </div>
            <div class="confirm-modal-body">
                <p>Review the following changes before saving:</p>
                <div class="changes-diff" id="changesDiff">
                    <!-- Diff will be populated here -->
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="cancelSaveBtn" class="action-btn secondary"><i class="fa-solid fa-times"></i> Cancel</button>
                <button id="confirmSaveBtn" class="action-btn primary"><i class="fa-solid fa-check"></i> Confirm Save</button>
            </div>
        </div>
    </div>

    <!-- Gallery Settings Modal -->
    <div id="gallerySettingsModal" class="confirm-modal hidden">
        <div class="confirm-modal-content settings-modal-content settings-with-sidebar">
            <div class="confirm-modal-header">
                <h3><i class="fa-solid fa-gear"></i> Gallery Settings</h3>
                <button class="close-confirm-btn" id="closeSettingsModal">&times;</button>
            </div>
            <div class="settings-layout">
                <!-- Settings Sidebar Navigation -->
                <nav class="settings-sidebar">
                    <ul class="settings-nav">
                        <li class="settings-nav-item active" data-section="general">
                            <i class="fa-solid fa-sliders"></i>
                            <span>General</span>
                        </li>
                        <li class="settings-nav-item" data-section="chub">
                            <i class="fa-solid fa-cloud"></i>
                            <span>ChubAI</span>
                        </li>
                        <li class="settings-nav-item" data-section="media">
                            <i class="fa-solid fa-photo-film"></i>
                            <span>Media</span>
                        </li>
                        <li class="settings-nav-item" data-section="gallery-folders">
                            <i class="fa-solid fa-folder-tree"></i>
                            <span>Gallery Folders</span>
                        </li>
                        <li class="settings-nav-item" data-section="developer">
                            <i class="fa-solid fa-code"></i>
                            <span>Developer</span>
                        </li>
                    </ul>
                </nav>
                
                <!-- Settings Content Panels -->
                <div class="settings-content">
                    <!-- General Section -->
                    <div class="settings-panel active" data-section="general">
                        <div class="settings-panel-header">
                            <h4><i class="fa-solid fa-sliders"></i> General Settings</h4>
                            <p class="settings-panel-desc">Search, sort, and display preferences</p>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-search"></i> Search Defaults</div>
                            <div class="settings-row checkboxes">
                                <label><input type="checkbox" id="settingsSearchName" checked> Character Name</label>
                                <label><input type="checkbox" id="settingsSearchTags" checked> Tags</label>
                                <label><input type="checkbox" id="settingsSearchAuthor"> Author</label>
                                <label><input type="checkbox" id="settingsSearchNotes"> Creator Notes</label>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-sort"></i> Default Sort</div>
                            <div class="settings-row">
                                <select id="settingsDefaultSort" class="glass-select">
                                    <option value="name_asc" data-icon="fa-solid fa-arrow-down-a-z">Name (A-Z)</option>
                                    <option value="name_desc" data-icon="fa-solid fa-arrow-up-z-a">Name (Z-A)</option>
                                    <option value="date_new" data-icon="fa-solid fa-clock-rotate-left">Last Modified (Newest)</option>
                                    <option value="date_old" data-icon="fa-solid fa-clock-rotate-left">Last Modified (Oldest)</option>
                                    <option value="created_new" data-icon="fa-solid fa-calendar-plus">Date Created (Newest)</option>
                                    <option value="created_old" data-icon="fa-solid fa-calendar-plus">Date Created (Oldest)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-clone"></i> Duplicate Detection</div>
                            <div class="settings-row">
                                <label for="settingsMinScore">Minimum Match Score:</label>
                                <div class="settings-slider-group">
                                    <input type="range" id="settingsMinScore" min="20" max="80" step="5" value="35">
                                    <span id="minScoreValue">35</span>
                                </div>
                                <span class="settings-hint">Lower = more matches shown</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-palette"></i> Appearance</div>
                            <div class="settings-row">
                                <label for="settingsHighlightColor">Accent Color:</label>
                                <div class="settings-input-group color-input-group">
                                    <input type="color" id="settingsHighlightColor" value="#4a9eff">
                                    <span class="color-preview-label">Click to change</span>
                                </div>
                            </div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsReplaceUserPlaceholder" checked> Replace {{user}} with persona name
                                </label>
                                <span class="settings-hint">Show your active SillyTavern persona name instead of {{user}}</span>
                            </div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsRichCreatorNotes"> Rich creator's notes rendering
                                </label>
                                <span class="settings-hint">Uses sandboxed iframe to render with full CSS/HTML support. May cause issues with unusual formatting.</span>
                            </div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsShowChubTagline" checked> Show ChubAI tagline in character details
                                </label>
                                <span class="settings-hint">Display the ChubAI tagline below metadata in the Details tab.</span>
                            </div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsAllowRichTagline"> Allow rich tagline display
                                </label>
                                <span class="settings-hint">Render HTML formatting in taglines (sanitized). Use with care.</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-bell"></i> Notifications</div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsNotifyAdditionalContent" checked> Notify about additional content on import
                                </label>
                                <span class="settings-hint">Show notification when imported characters have gallery images or embedded media available</span>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-clock-rotate-left"></i> Version History</div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsAutoSnapshotOnEdit"> Auto-snapshot before edits and updates
                                </label>
                                <span class="settings-hint">Automatically save a snapshot of the character's current state before applying edits, card updates, or restores</span>
                            </div>
                            <div class="settings-row">
                                <label for="settingsMaxAutoBackups">Max auto-backup snapshots per character:</label>
                                <div class="settings-input-group" style="align-items: center; gap: 8px;">
                                    <input type="number" id="settingsMaxAutoBackups" min="0" max="100" value="10" style="width: 70px;">
                                    <span class="settings-hint" style="margin: 0;">0 = unlimited</span>
                                </div>
                            </div>
                        </div>

                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-flask"></i> Experimental</div>
                        </div>
                    </div>
                    
                    <!-- ChubAI Section -->
                    <div class="settings-panel" data-section="chub">
                        <div class="settings-panel-header">
                            <h4><i class="fa-solid fa-cloud"></i> ChubAI Integration</h4>
                            <p class="settings-panel-desc">Configure ChubAI connection and features</p>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-key"></i> Authentication</div>
                            <div class="settings-row">
                                <label for="settingsChubToken">URQL Token:</label>
                                <div class="settings-input-group">
                                    <input type="password" id="settingsChubToken" placeholder="Enter your ChubAI URQL token" autocomplete="off" data-sensitive="true">
                                    <button id="toggleChubTokenVisibility" class="glass-btn icon-only" title="Show/Hide">
                                        <i class="fa-solid fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsRememberToken"> Remember token
                                </label>
                                <span class="settings-hint">Token location: DevTools ‚Üí Application ‚Üí Cookies ‚Üí "__Secure-next-auth.session-token"</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-arrows-rotate"></i> Card Updates</div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsChubUseV4Api"> Use V4 Git API for update checks (debug)
                                </label>
                                <span class="settings-hint">Uses the Git repository's card.json for all update check fields instead of the metadata API. Slower and may fail for some characters. Lorebooks from linked projects are always resolved via V4 regardless of this setting.</span>
                            </div>
                            <div class="settings-row" style="flex-direction: column; align-items: flex-start; gap: 8px;">
                                <span class="settings-hint" style="margin-bottom: 4px;">Check all Chub-linked characters for differences against the remote version. You can review each change and selectively apply updates.</span>
                                <button id="batchCheckUpdatesBtn" class="settings-action-btn primary">
                                    <i class="fa-solid fa-arrows-rotate"></i> Check All for Updates
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Media Section -->
                    <div class="settings-panel" data-section="media">
                        <div class="settings-panel-header">
                            <h4><i class="fa-solid fa-photo-film"></i> Media Localization</h4>
                            <p class="settings-panel-desc">Download and manage embedded media</p>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-link-slash"></i> URL Replacement</div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsMediaLocalization" checked> Replace remote URLs with local files
                                </label>
                                <span class="settings-hint">Auto-replace embedded remote media with local gallery files. Files must be downloaded first.</span>
                            </div>
                            <div class="settings-row settings-sub-note">
                                <span class="settings-hint"><i class="fa-solid fa-info-circle"></i> Per-character overrides available in the character detail panel.</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-download"></i> Bulk Operations</div>
                            <div class="settings-row">
                                <button id="bulkLocalizeBtn" class="settings-action-btn primary">
                                    <i class="fa-solid fa-download"></i> Bulk Localize All Characters
                                </button>
                                <span class="settings-hint">Scan and download remote media for ALL characters. Previously processed are skipped.</span>
                            </div>
                            <div class="settings-row">
                                <button id="clearBulkLocalizeHistoryBtn" class="settings-action-btn danger">
                                    <i class="fa-solid fa-eraser"></i> Clear Processed History
                                </button>
                                <span class="settings-hint">Reset the processed list so bulk localize scans everyone again.</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-gear"></i> Options</div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsIncludeChubGallery"> Include ChubAI Gallery
                                </label>
                                <span class="settings-hint">Also download Chub gallery images for linked characters.</span>
                            </div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsFixFilenames" checked> Fix filenames during localization
                                </label>
                                <span class="settings-hint">Rename files to localized_media_* format when duplicates are detected.</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gallery Folders Section -->
                    <div class="settings-panel" data-section="gallery-folders">
                        <div class="settings-panel-header">
                            <h4><i class="fa-solid fa-folder-tree"></i> Unique Gallery Folders</h4>
                            <p class="settings-panel-desc">Give each character their own gallery, even if they share names</p>
                        </div>
                        
                        <div class="settings-warning">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                            <span>This feature writes a unique ID into each character card. <strong>Backup your characters folder first.</strong></span>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-toggle-on"></i> Enable Feature</div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsUniqueGalleryFolders"> Use unique gallery folder names
                                </label>
                                <span class="settings-hint">Folders use format: <code>CharName_abc123xyz</code></span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-wand-magic-sparkles"></i> Step 1: Assign IDs</div>
                            <span class="settings-hint">Generate unique IDs for all characters and register folder mappings.</span>
                            <div class="settings-row" style="margin-top: 8px;">
                                <button id="migrateGalleryFoldersBtn" class="settings-action-btn primary">
                                    <i class="fa-solid fa-wand-magic-sparkles"></i> Assign Gallery IDs
                                </button>
                            </div>
                            <div class="settings-row" id="galleryMigrationStatus" style="display: none;">
                                <span class="settings-hint" id="galleryMigrationStatusText" style="color: var(--accent);"></span>
                            </div>
                            <div class="settings-row settings-sub-note">
                                <span class="settings-hint"><i class="fa-solid fa-info-circle"></i> Refresh SillyTavern page after migration.</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-truck-moving"></i> Step 2: Migrate Images</div>
                            <span class="settings-hint">Move existing images from old folders to new unique folders.</span>
                            
                            <div class="settings-sub-section">
                                <div class="settings-sub-title"><i class="fa-solid fa-user"></i> Unique Names</div>
                                <span class="settings-hint">Simply moves all images from {{charname}} folder into {charname}_{uuid} folder.</span>
                                <div class="settings-row" style="margin-top: 6px;">
                                    <button id="migrateAllImagesBtn" class="settings-action-btn">
                                        <i class="fa-solid fa-truck-moving"></i> Migrate All
                                    </button>
                                </div>
                                <div class="settings-row" id="migrateAllStatus" style="display: none;">
                                    <span class="settings-hint" id="migrateAllStatusText" style="color: var(--accent);"></span>
                                </div>
                            </div>
                            
                            <div class="settings-sub-section">
                                <div class="settings-sub-title"><i class="fa-solid fa-users"></i> Shared Names</div>
                                <span class="settings-hint">Uses fingerprinting to sort images to correct owners.</span>
                                <div class="settings-row" style="margin-top: 6px;">
                                    <button id="relocateSharedImagesBtn" class="settings-action-btn">
                                        <i class="fa-solid fa-fingerprint"></i> Smart Relocate
                                    </button>
                                </div>
                                <div class="settings-row" id="imageRelocationStatus" style="display: none;">
                                    <span class="settings-hint" id="imageRelocationStatusText" style="color: var(--accent);"></span>
                                </div>
                            </div>
                            
                            <div class="settings-row settings-sub-note" style="margin-top: 10px;">
                                <span class="settings-hint"><i class="fa-solid fa-hand-point-right"></i> Unmatched images remain in the original folder for manual handling.</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-map"></i> Reference</div>
                            <div class="settings-row">
                                <button id="viewFolderMappingBtn" class="settings-action-btn">
                                    <i class="fa-solid fa-map"></i> View Folder Mapping
                                </button>
                                <span class="settings-hint">See which unique folder belongs to which character.</span>
                            </div>
                            <div class="settings-row" style="margin-top: 8px;">
                                <button id="browseOrphanedFoldersBtn" class="settings-action-btn">
                                    <i class="fa-solid fa-folder-open"></i> Browse Orphaned Folders
                                </button>
                                <span class="settings-hint">Find and redistribute images from old legacy folders.</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-stethoscope"></i> Integrity Check</div>
                            <span class="settings-hint">Ensure gallery IDs and folder mappings are properly synchronized.</span>
                            
                            <div id="gallerySyncStatus" class="gallery-sync-status-box" style="margin-top: 10px;">
                                <div class="sync-status-placeholder">
                                    <i class="fa-solid fa-circle-question"></i>
                                    <span>Click "Run Audit" to check integrity</span>
                                </div>
                            </div>
                            
                            <div class="settings-row gallery-sync-buttons" style="margin-top: 10px;">
                                <button id="gallerySyncAuditBtn" class="settings-action-btn">
                                    <i class="fa-solid fa-magnifying-glass"></i> Run Audit
                                </button>
                                <button id="gallerySyncFullBtn" class="settings-action-btn primary">
                                    <i class="fa-solid fa-rotate"></i> Full Sync
                                </button>
                                <button id="gallerySyncCleanupBtn" class="settings-action-btn">
                                    <i class="fa-solid fa-broom"></i> Cleanup Orphans
                                </button>
                            </div>
                            <div class="settings-row settings-sub-note" style="margin-top: 8px;">
                                <span class="settings-hint"><i class="fa-solid fa-info-circle"></i> Full Sync assigns missing IDs, creates missing mappings, and removes orphaned entries.</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Developer Section -->
                    <div class="settings-panel" data-section="developer">
                        <div class="settings-panel-header">
                            <h4><i class="fa-solid fa-code"></i> Developer Options</h4>
                            <p class="settings-panel-desc">Debugging and troubleshooting tools</p>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-terminal"></i> Logging</div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsDebugMode"> Enable debug logging
                                </label>
                                <span class="settings-hint">Output detailed info to browser console (DevTools ‚Üí Console)</span>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-microscope"></i> Character Inspection</div>
                            <div class="settings-row">
                                <label>
                                    <input type="checkbox" id="settingsShowInfoTab"> Show "Info" tab in character modal
                                </label>
                                <span class="settings-hint">Displays card metadata, file paths, and internal mappings for debugging</span>
                            </div>
                        </div>
                        

                        
                        <div class="settings-group">
                            <div class="settings-group-title"><i class="fa-solid fa-info-circle"></i> Version Info</div>
                            <div class="settings-row">
                                <span class="settings-hint" style="font-family: monospace;">Character Library v4.1.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="confirm-modal-footer">
                <button id="resetSettingsBtn" class="action-btn secondary"><i class="fa-solid fa-undo"></i> Restore Defaults</button>
                <button id="saveSettingsBtn" class="action-btn primary"><i class="fa-solid fa-check"></i> Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Toast container ‚Äî placed last to guarantee it renders above all modals -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="library.js?v=74"></script>
    <script type="module" src="../modules/module-loader.js?v=2"></script>
    <script src="library-mobile.js?v=1"></script>
</body>
</html>