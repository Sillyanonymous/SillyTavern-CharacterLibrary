/* ========================================
   SillyTavern Character Library – Mobile
   Mobile specific overrides
   ======================================== */

/* ----------------------------------------
   SHARED (all ≤768px)
   Reset fundamentals once, avoid duplication
   ---------------------------------------- */
@media screen and (max-width: 768px) {

    /* --- Viewport lock --- */
    html, body, .app-container {
        max-width: 100vw !important;
        overflow-x: hidden !important;
        height: 100vh !important;
        height: 100dvh !important; /* dynamic viewport — tracks browser chrome */
    }

    /* --- Global touch optimizations --- */
    * {
        -webkit-tap-highlight-color: transparent;
    }
    button, a, .glass-btn, .view-toggle-btn, .char-card, .chat-card,
    .ms-btn, .chub-card, .mobile-sheet-item, .dropdown-item {
        touch-action: manipulation; /* eliminate 300ms tap delay */
    }

    /* --- Topbar stability --- */
    .topbar {
        flex-shrink: 0; /* never compress when toolbar appears */
        position: sticky;
        top: 0;
        z-index: 100;
    }

    /* --- Disable hover effects on touch --- */
    .char-card {
        transition: none !important; /* no hover/animation jank */
    }
    .char-card:hover {
        transform: none !important;
        box-shadow: none !important;
    }
    .char-card:hover .card-image {
        transform: none !important;
    }

    /* --- JS-created mobile buttons (search / settings / menu) --- */
    #mobileSearchBtn,
    #mobileSettingsBtn,
    #mobileMenuBtn {
        display: flex !important;
        align-items: center;
        justify-content: center;
        padding: 6px 8px;
        font-size: 0.9rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--glass-border);
        border-radius: 8px;
        color: var(--text-primary);
        cursor: pointer;
    }
    #mobileSettingsBtn {
        margin-left: auto;
    }
    #mobileMenuBtn {
        margin-left: 6px;
    }

    /* --- Hide desktop-only chrome --- */
    .search-box,
    .search-settings-container,
    .filter-area:not(.chub-filters),
    .filters-wrapper,
    .gallery-sync-container,
    .more-options-container {
        display: none !important;
    }

    /* Tag filter popup – fixed overlay (moved to body via JS) */
    #tagFilterPopup {
        position: fixed !important;
        left: 0 !important;
        right: 0 !important;
        top: auto !important;
        bottom: 0 !important;
        width: 100% !important;
        max-height: 70vh !important;
        border-radius: 16px 16px 0 0 !important;
        z-index: 1100 !important;
        background: var(--bg-secondary) !important;
        border: 1px solid var(--glass-border) !important;
        border-bottom: none !important;
        backdrop-filter: blur(20px) !important;
        box-shadow: 0 -4px 30px rgba(0,0,0,0.5) !important;
        flex-direction: column !important;
        padding-bottom: env(safe-area-inset-bottom, 0px) !important;
    }
    #tagFilterPopup .tag-search-row {
        padding: 12px;
        gap: 8px;
        border-bottom: 1px solid var(--glass-border);
        position: sticky;
        top: 0;
        background: var(--bg-secondary);
        z-index: 1;
    }
    #tagFilterPopup .tag-search-row input { font-size: 16px; padding: 10px 12px; }
    #tagFilterPopup .tag-item,
    #tagFilterPopup .tag-filter-item { padding: 10px 14px; min-height: 40px; }
    #tagFilterContent { padding-bottom: 20px; }

    /* Scrim behind tag popup */
    .mobile-tag-scrim {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1099;
    }

    /* Search area: only holds the mobile search btn */
    .search-area {
        flex: 0 0 auto;
        min-width: auto;
        max-width: none;
        gap: 0;
    }

    /* ---------------------------------------------------
       SEARCH OVERLAY  (JS moves the real .search-box here)
       --------------------------------------------------- */
    .mobile-search-overlay {
        position: fixed;
        top: calc(env(safe-area-inset-top, 0px) + 52px);
        right: 0;
        bottom: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.85);
        z-index: 1200;
        padding: 12px;
        box-sizing: border-box;
    }
    .mobile-search-overlay.hidden { display: none !important; }
    .mobile-search-overlay .search-box {
        display: flex !important;
        flex: 1;
        padding: 12px 15px;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: 12px;
        backdrop-filter: blur(20px);
    }
    .mobile-search-overlay .search-box input { font-size: 16px; }
    .mobile-search-container {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    /* ---------------------------------------------------
       BOTTOM SHEETS  (settings + menu, created by JS)
       --------------------------------------------------- */
    .mobile-sheet-overlay {
        position: fixed;
        inset: 0;
        z-index: 1200;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
    }
    .mobile-sheet-overlay.hidden { display: none !important; }
    .mobile-sheet-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
    }
    .mobile-sheet {
        position: relative;
        background: rgba(30, 30, 30, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-bottom: none;
        border-radius: 16px 16px 0 0;
        max-height: 80vh;
        overflow-y: auto;
        transform: translateY(100%);
        transition: transform 0.3s ease;
        padding-bottom: max(20px, env(safe-area-inset-bottom));
    }
    .mobile-sheet.open { transform: translateY(0); }
    .mobile-sheet-handle {
        width: 36px; height: 4px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
        margin: 12px auto;
    }
    .mobile-sheet-item {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 15px 20px;
        background: none;
        border: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        color: white;
        font-size: 1rem;
        text-align: left;
        cursor: pointer;
        width: 100%;
    }
    .mobile-sheet-item:last-child { border-bottom: none; }
    .mobile-sheet-item:active { background: rgba(255, 255, 255, 0.1); }
    .mobile-sheet-item i { width: 20px; text-align: center; color: var(--accent); }

    /* Settings sheet fields */
    .mobile-settings-body { padding: 0 20px 20px; }
    .mobile-settings-section { margin-bottom: 16px; }
    .mobile-settings-label {
        font-size: 0.7rem; font-weight: 700;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
    }
    .mobile-settings-select {
        width: 100%;
        padding: 11px 14px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid var(--glass-border);
        border-radius: 10px;
        color: white;
        font-size: 0.95rem;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 14px center;
    }
    .mobile-settings-select:focus { outline: none; border-color: var(--accent); }
    .mobile-settings-row { display: flex; gap: 8px; }
    .mobile-filter-chip {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 11px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid var(--glass-border);
        border-radius: 10px;
        color: white;
        font-size: 0.9rem;
        cursor: pointer;
    }
    .mobile-filter-chip:active { transform: scale(0.97); }
    .mobile-filter-chip.active {
        background: var(--accent);
        border-color: var(--accent);
    }
    .mobile-settings-checks {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
    }
    .mobile-check-label {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 8px;
        font-size: 0.85rem;
        cursor: pointer;
    }
    .mobile-check-label input {
        width: 18px; height: 18px;
        accent-color: var(--accent);
    }

    /* ---------------------------------------------------
       ALL MODALS – base mobile rules
       --------------------------------------------------- */

    /* Modal overlay must sit ABOVE the topbar (both are z-index:100) */
    .modal-overlay {
        padding: 0;
        z-index: 200 !important;
        align-items: flex-start !important; /* prevent centering overflow cropping the top */
    }

    /* Full-viewport for every modal-glass variant */
    .modal-glass,
    .section-expand-modal,
    .chub-expand-modal,
    .lorebook-expand-modal,
    .creator-notes-fullscreen-modal,
    .content-fullscreen-modal {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
        border: none !important;
        box-sizing: border-box;
    }
    /* Override data-size attributes that set explicit widths */
    .creator-notes-fullscreen-modal[data-size],
    .content-fullscreen-modal[data-size],
    .chub-expand-modal[data-size] {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
    }

    /* Modal header – compact but visible */
    .modal-header {
        display: flex;
        align-items: center;
        padding: 10px 14px;
        min-height: 48px;
        gap: 8px;
        flex-shrink: 0;
        position: relative;
        z-index: 1;
    }
    .modal-header h2 {
        font-size: 0.95rem;
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        min-width: 0;
    }

    .chub-tagline-row {
        font-size: 0.85rem;
        margin: -10px 0 16px 0;
        padding: 0 12px 0 3px;
    }

    /* Mobile avatar injected into header by JS */
    .modal-header .mobile-header-avatar {
        width: 32px; height: 32px;
        border-radius: 6px;
        object-fit: cover;
        flex-shrink: 0;
    }

    /* Mobile avatar quick-view overlay */
    .mobile-avatar-viewer {
        position: fixed;
        inset: 0;
        z-index: 10100;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.9);
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
    }
    .mobile-avatar-viewer img {
        max-width: 90%;
        max-height: 85vh;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
    }
    .mobile-header-avatar {
        cursor: pointer;
    }
    .chub-char-avatar {
        cursor: pointer;
    }

    /* Close button – always visible, always tappable */
    .close-btn {
        display: flex !important;
        align-items: center;
        justify-content: center;
        font-size: 1.6rem;
        min-width: 44px;
        min-height: 44px;
        flex-shrink: 0;
        padding: 0;
        -webkit-tap-highlight-color: rgba(255,255,255,0.1);
    }
    #modalChatBtn {
        padding: 6px 8px;
        font-size: 0;
        gap: 0;
        border-radius: 10px;
        margin-right: 10px;
        background: transparent;
        border: 1px solid rgba(var(--accent-rgb), 0.85);
        box-shadow: 0 0 8px rgba(var(--accent-rgb), 0.45), inset 0 0 6px rgba(var(--accent-rgb), 0.25);
    }
    #modalChatBtn i {
        font-size: 0.95rem;
        color: var(--accent);
    }
    .mobile-chat-hidden {
        display: none !important;
    }

    /* ---------------------------------------------------
       HIDE DESKTOP-ONLY CONTROLS IN ALL MODAL TYPES
       One rule to catch every variantt
       --------------------------------------------------- */

    /* Size controls (compact/normal/wide) – hide everywhere */
    #sizeControlBtns,
    #contentSizeControlBtns,
    #chubExpandSizeControls,
    #altGreetingsSizeControlBtns {
        display: none !important;
    }

    /* Zoom controls – hide entirely on mobile (zoom set via CSS) */
    .zoom-level,
    [data-zoom="reset"],
    #greetingsZoomControls,
    #lorebookZoomControls {
        display: none !important;
    }

    /* The display-control containers: show only for zoom +/- */
    .creator-notes-display-controls,
    .modal-header-controls,
    .chub-expand-display-controls {
        display: flex !important;
        align-items: center;
        gap: 4px;
        flex-shrink: 0;
    }

    /* Expanded modal titles – smaller */
    .section-expand-modal .modal-header h2,
    .chub-expand-modal .modal-header h2,
    .creator-notes-fullscreen-modal .modal-header h2,
    .content-fullscreen-modal .modal-header h2 {
        font-size: 0.8rem;
    }

    /* Hide save/apply action buttons in expanded modals */
    .section-expand-modal .modal-controls .action-btn,
    .chub-expand-modal .modal-controls .action-btn {
        display: none !important;
    }

    /* ---------------------------------------------------
       GLOBAL ACTION BUTTONS – compact for mobile
       --------------------------------------------------- */
    .action-btn {
        padding: 8px 14px;
        font-size: 0.8rem;
        gap: 8px;
        min-height: 38px;
        border-radius: 8px;
    }
    .action-btn.small {
        padding: 6px 10px;
        font-size: 0.75rem;
        min-height: 32px;
        gap: 6px;
    }
    .action-btn:hover {
        transform: none; /* disable hover lift on touch */
    }
    .modal-controls {
        gap: 6px;
        flex-wrap: wrap;
    }
    .modal-controls .action-btn {
        padding: 8px 12px;
        font-size: 0.8rem;
        min-height: 38px;
    }
    .modal-controls .close-btn {
        width: 34px; height: 34px;
        font-size: 1rem;
    }
    /* Settings panel buttons */
    .settings-action-btn {
        padding: 8px 14px;
        font-size: 0.8rem;
        min-height: 44px;
        touch-action: manipulation;
    }
    .settings-action-btn:hover {
        transform: none;
        box-shadow: none;
    }

    /* ---------------------------------------------------
       CHARACTER DETAIL MODAL  (#charModal)
       --------------------------------------------------- */
    #charModal .modal-controls > *:not(#modalClose):not(#modalChatBtn) {
        display: none !important;
    }

    /* Sidebar completely hidden */
    .modal-sidebar { display: none !important; }

    /* Body stacks vertically */
    .modal-body {
        flex-direction: column;
        overflow-y: auto;
    }

    /* Tab strip – compact scrollable */
    .tab-nav {
        display: flex !important;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        gap: 0;
        padding: 0;
        flex-shrink: 0;
    }
    .tab-nav::-webkit-scrollbar { display: none; }
    .tab-btn {
        padding: 9px 14px;
        font-size: 0.78rem;
        white-space: nowrap;
        flex-shrink: 0;
    }

    /* Info tab: icon-only on mobile */
    #infoTabBtn {
        font-size: 0;
        padding-left: 12px;
        padding-right: 12px;
    }
    #infoTabBtn i {
        display: inline-block;
        font-size: 0.78rem;
    }

    /* ---------------------------------------------------
       TAB PANE CONTENT
       --------------------------------------------------- */
    .tab-pane {
        padding: 14px;
        padding-bottom: 60px;
    }

    @keyframes tab-slide-from-right {
        from { transform: translateX(25%); opacity: 0; }
        to   { transform: translateX(0);   opacity: 1; }
    }
    @keyframes tab-slide-from-left {
        from { transform: translateX(-25%); opacity: 0; }
        to   { transform: translateX(0);    opacity: 1; }
    }
    .tab-pane.slide-from-right { animation: tab-slide-from-right 0.2s ease-out; }
    .tab-pane.slide-from-left  { animation: tab-slide-from-left  0.2s ease-out; }
    .meta-info {
        font-size: 0.8rem;
        padding: 10px 12px;
        margin-bottom: 14px;
    }
    .description-box, .first-mes-box { margin-bottom: 16px; }
    .description-box h3, .first-mes-box h3,
    h3 { font-size: 0.9rem; margin-bottom: 8px; padding-bottom: 6px; }
    .scrolling-text {
        font-size: 0.85rem;
        padding: 12px;
        line-height: 1.5;
    }

    /* Details/summary sections (creator's notes, alt greetings, lorebook) */
    .creator-notes-details,
    #altGreetingsDetails,
    .lorebook-box details {
        padding: 10px !important;
        border-radius: 8px !important;
    }
    .creator-notes-details summary,
    #altGreetingsDetails summary,
    .lorebook-box summary {
        font-size: 0.85rem !important;
        gap: 6px !important;
    }
    /* Expand buttons inside summaries – bigger tap target */
    .creator-notes-expand-btn,
    .content-expand-btn {
        min-width: 34px !important;
        min-height: 34px !important;
        width: 34px !important;
        height: 34px !important;
    }

    /* Edit tab */
    .edit-section {
        padding: 12px;
        margin-bottom: 14px;
        border-radius: 10px;
    }
    .section-header { font-size: 0.85rem; margin-bottom: 12px; padding-bottom: 8px; }
    .form-row { flex-direction: column; gap: 0; }
    .form-group { margin-bottom: 12px; }
    .form-group label { font-size: 0.8rem; margin-bottom: 5px; }
    /* Expand-field buttons – smaller on mobile so they center within label rows */
    .expand-field-btn {
        width: 18px;
        height: 18px;
        font-size: 0.6rem;
        border-radius: 4px;
    }
    .section-expand-btn {
        width: 22px;
        height: 22px;
        font-size: 0.65rem;
        border-radius: 5px;
    }
    .glass-input { font-size: 16px; padding: 10px 12px; } /* 16px prevents iOS zoom */
    textarea.glass-input { min-height: 60px; }
    .edit-lock-header { flex-wrap: wrap; gap: 8px; padding: 10px 12px; }
    .edit-lock-header .lock-status { width: 100%; font-size: 0.82rem; }
    .lock-header-actions { width: 100%; display: flex; gap: 6px; }
    .lock-header-actions .action-btn {
        flex: 1;
        justify-content: center;
        font-size: 0.8rem;
        padding: 8px 12px;
    }
    #editPaneVersionsBtn {
        background: rgba(var(--accent-rgb), 0.12);
        border-color: rgba(var(--accent-rgb), 0.3);
        color: var(--accent);
    }

    /* ---------------------------------------------------
       VERSIONS TAB (character-versions.js module)
       Drill-down: list view → tap item → detail view
       --------------------------------------------------- */

    .vt-container { gap: 8px; }

    /* Back button — only visible in detail view */
    .vt-back-btn { display: none !important; }
    .vt-container.vt-detail-open .vt-back-btn {
        display: flex !important;
        min-height: 36px;
        color: var(--cl-accent, #4a9eff);
        border-color: rgba(var(--cl-accent-rgb, 74,158,255), 0.3);
        background: rgba(var(--cl-accent-rgb, 74,158,255), 0.08);
        touch-action: manipulation;
    }

    /* Toolbar — sub-tabs fill first row, buttons fill second */
    .vt-toolbar { flex-wrap: wrap; gap: 6px; }
    .vt-sub-tabs { flex: 1 1 100%; order: -1; }
    .vt-sub-tab {
        flex: 1;
        justify-content: center;
        padding: 8px 10px;
        font-size: 0.8rem;
        min-height: 36px;
    }
    .vt-toolbar-right { flex: 1 1 100%; justify-content: stretch; }
    .vt-toolbar-right .vt-btn {
        flex: 1;
        justify-content: center;
        min-height: 36px;
    }

    .vt-status { font-size: 0.8rem; padding: 6px 10px; }

    /* Body — vertical stack */
    .vt-body { flex-direction: column; overflow: visible; }

    /* List — full-width vertical, standard mobile list */
    .vt-list {
        min-width: unset;
        max-width: 100%;
        max-height: none;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding: 4px;
        gap: 6px;
    }

    /* Items — full-width rows, touch-friendly */
    .vt-item { padding: 10px 12px; min-height: 44px; }
    .vt-item-header { gap: 4px; }
    .vt-item-id { font-size: 0.78rem; }
    .vt-item-label { font-size: 0.82rem; }
    .vt-item-title { font-size: 0.75rem; }
    .vt-item-date { font-size: 0.7rem; }

    /* --- Drill-down: hide list in detail view --- */
    .vt-container.vt-detail-open .vt-toolbar { display: none; }
    .vt-container.vt-detail-open .vt-status { display: none; }
    .vt-container.vt-detail-open .vt-list { display: none; }

    /* Hide preview & actions until detail is open */
    .vt-container:not(.vt-detail-open) .vt-preview { display: none !important; }
    .vt-container:not(.vt-detail-open) .vt-actions { display: none !important; }

    /* Preview — scrollable content in detail view */
    .vt-preview {
        flex: 1;
        min-height: 0;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    .vt-preview-header { font-size: 0.82rem; padding: 6px 8px; margin-bottom: 8px; }

    /* Diff items */
    .vt-diff-list { gap: 6px; }
    .vt-diff-item.short {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
        padding: 8px 10px;
    }
    .vt-diff-label { font-size: 0.78rem; min-width: unset; }
    .vt-diff-vals { width: 100%; font-size: 0.78rem; }
    .vt-diff-header { padding: 8px 10px; min-height: 44px; }
    .vt-diff-content { max-height: 220px; font-size: 0.78rem; }
    .vt-diff-line { padding: 2px 8px 2px 4px; }

    /* Tags diff */
    .vt-tag-content { padding: 8px; }
    .vt-tag-pills { gap: 5px; }
    .vt-tag-pill { font-size: 0.75rem; padding: 3px 8px; }

    /* Greetings diff */
    .vt-greeting-header { padding: 8px 10px; min-height: 40px; font-size: 0.78rem; }
    .vt-greeting-body { max-height: 180px; font-size: 0.78rem; }

    /* Avatar preview */
    .vt-avatar-preview { padding: 8px; gap: 10px; }
    .vt-avatar-thumb { width: 48px; height: 48px; }
    .vt-apply-avatar { width: 36px; height: 36px; }

    /* Actions bar — pinned at bottom of detail view */
    .vt-actions { flex-wrap: wrap; gap: 6px; padding-top: 8px; flex-shrink: 0; }
    .vt-actions-left, .vt-actions-right { gap: 6px; }
    .vt-actions .vt-btn { min-height: 40px; padding: 8px 12px; font-size: 0.8rem; }

    /* Buttons — touch sizing */
    .vt-btn { min-height: 36px; font-size: 0.8rem; touch-action: manipulation; }

    /* Dialogs */
    .vt-dialog { width: 95vw; max-width: 95vw; padding: 18px; border-radius: 12px; }
    .vt-dialog-title { font-size: 1rem; }
    .vt-dialog-msg { font-size: 0.85rem; }
    .vt-dialog-btns { gap: 8px; }
    .vt-dialog-btn { min-height: 40px; padding: 8px 14px; font-size: 0.85rem; }
    .vt-input { font-size: 16px; padding: 10px 12px; }

    .vt-loading, .vt-error { padding: 20px 12px; font-size: 0.82rem; }

    /* Chats tab (inside character modal) */
    .chats-header { display: none !important; } /* hide title + buttons */
    .chats-list { max-height: none; gap: 6px; }
    .chat-item { padding: 10px; gap: 10px; }
    .chat-item-icon { width: 32px; height: 32px; font-size: 0.8rem; border-radius: 8px; margin-right: 0; }
    .chat-item-info { min-width: 0; }
    .chat-item-name { font-size: 0.85rem; }
    .chat-item-meta { font-size: 0.7rem; gap: 8px; flex-wrap: wrap; }
    .chat-item-actions { opacity: 1; gap: 4px; } /* always visible on mobile */
    .chat-action-btn { width: 34px; height: 34px; border-radius: 8px; }

    /* Gallery tab (inside character modal) */
    .gallery-header { flex-wrap: nowrap; gap: 6px; padding-bottom: 10px; margin-bottom: 12px; }
    .gallery-header h4 { display: none !important; } /* hide title */
    .gallery-actions { flex-wrap: nowrap; gap: 6px; width: 100%; }
    /* Keep download/localize as compact icon-only buttons */
    #localizeMediaBtn { font-size: 0; padding: 8px 10px; } /* hide text, show icon */
    #localizeMediaBtn i { font-size: 0.85rem; margin: 0; }
    .localize-toggle { padding: 6px 8px; font-size: 0; } /* icon-only */
    .localize-toggle-label { font-size: 0; gap: 0; }
    .localize-toggle-label i { font-size: 0.85rem; }
    .legacy-indicator { font-size: 0.75rem; }
    .gallery-sprites-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 6px;
    }
    .upload-zone { font-size: 0.8rem; padding: 16px 12px; border-width: 1px; }

    /* Related tab (inside character modal) */
    .related-header h4 { display: none !important; } /* hide title */
    .related-info { font-size: 0.75rem; padding: 6px 10px; margin-bottom: 10px; }
    .related-filters { flex-wrap: wrap; gap: 6px; padding: 8px; margin-bottom: 12px; }
    .related-filter-toggle { font-size: 0.78rem; padding: 5px 10px; }
    .related-filter-toggle span { font-size: 0.78rem; }
    .related-section-header { font-size: 0.8rem; padding: 6px 0; margin-bottom: 8px; }
    .related-card { gap: 10px; padding: 8px 10px; }
    .related-card-avatar { width: 40px; height: 40px; border-radius: 6px; }
    .related-card-name { font-size: 0.85rem; }
    .related-card-creator { font-size: 0.75rem; }
    .related-card-reasons { font-size: 0.7rem; }
    .related-score-value { font-size: 1rem; }

    /* ---------------------------------------------------
       EXPANDED MODAL BODIES – minimal padding + default zoom
       CSS zoom applied directly — no JS button-clicking needed.
       The JS just updates the zoom display label to match.
       --------------------------------------------------- */
    .section-expand-body {
        padding: 4px;
        gap: 6px;
        zoom: 80% !important;
    }
    .creator-notes-fullscreen-body {
        zoom: 90% !important;
    }

    /* Lorebook modal: hide the sub-header bar (entry count + actions)
       since actions are moved into modal header by JS */
    .lorebook-expand-modal .expanded-lorebook-header {
        display: none !important;
    }

    /* Lorebook action buttons when moved into the modal header */
    .lorebook-expand-modal .modal-header-controls .expanded-lorebook-header-actions {
        display: flex !important;
        align-items: center;
        gap: 4px;
    }
    .lorebook-expand-modal .modal-header-controls .expanded-lorebook-header-actions .action-btn.small {
        padding: 4px 6px;
        font-size: 0.7rem;
        min-height: unset;
        border-radius: 5px;
    }
    .lorebook-expand-modal .modal-header-controls .expanded-lorebook-header-actions .action-btn.small i {
        font-size: 0.65rem;
    }

    .expanded-greeting-section { padding: 4px; }
    .expanded-section-label { font-size: 0.85rem; margin-bottom: 6px; padding: 0 4px; }
    .expanded-greeting-textarea,
    .expand-field-textarea { font-size: 0.85rem; padding: 8px; border-radius: 6px; }
    .chub-expand-body { padding: 4px; }
    .creator-notes-fullscreen-body { padding: 4px; }
    .content-fullscreen-body { padding: 4px; }
    .content-fullscreen-body .content-wrapper {
        font-size: 0.85rem;
        line-height: 1.6;
        padding: 4px;
    }
    /* Expanded modal headers – tighter */
    .section-expand-modal .modal-header,
    .chub-expand-modal .modal-header,
    .creator-notes-fullscreen-modal .modal-header,
    .content-fullscreen-modal .modal-header {
        padding: 8px 10px;
        min-height: 40px;
    }

    /* ---------------------------------------------------
       CONFIRM / MISC MODALS
       --------------------------------------------------- */
    .confirm-modal-content {
        width: 95vw;
        max-width: 95vw;
        border-radius: 12px;
    }
    .confirm-modal-header { padding: 12px 16px; }
    .confirm-modal-header h3 { font-size: 0.9rem; }
    .confirm-modal-body { padding: 14px 16px; font-size: 0.85rem; }
    .confirm-modal-footer { padding: 10px 16px; }

    /* ChubAI character detail modal */
    .chub-char-modal {
        width: 100% !important;
        max-width: 100% !important;
        max-height: 100% !important;
        height: 100% !important;
        border-radius: 0 !important;
    }
    .chub-char-modal .modal-header {
        padding: 10px 12px;
        padding-right: 40px; /* room for absolute close btn */
        position: relative;
        flex-wrap: wrap;
        gap: 6px 8px;
    }
    .chub-char-modal .chub-char-header-info {
        width: 100%; /* force controls to wrap below */
    }
    .chub-char-modal .modal-controls {
        display: flex;
        gap: 6px;
        flex-wrap: nowrap;
        align-items: center;
        justify-content: flex-start;
    }
    .chub-char-modal .modal-controls > .close-btn {
        display: flex !important;
        position: absolute;
        top: 8px;
        right: 8px;
        width: 30px; height: 30px;
        font-size: 1.1rem;
    }
    .chub-char-modal .action-btn {
        font-size: 0.72rem;
        padding: 5px 10px;
        min-height: 28px;
        gap: 5px;
        white-space: nowrap;
    }
    .chub-char-avatar { width: 40px; height: 40px; border-radius: 8px; }
    .chub-char-header-info { gap: 10px; min-width: 0; overflow: hidden; }
    .chub-char-header-info > div { min-width: 0; overflow: hidden; }
    .chub-char-header-info h2 { font-size: 0.95rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .chub-char-meta { font-size: 0.75rem; overflow: hidden; }
    .chub-char-body { overflow-x: hidden !important; padding: 12px; }
    .chub-char-body { gap: 12px; }
    .chub-char-tagline {
        padding: 10px 12px;
        border-radius: 10px;
        font-size: 0.85rem;
        line-height: 1.5;
    }
    .chub-tagline-text { font-size: 0.85rem; }
    .chub-char-meta-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    .chub-char-stats {
        display: flex;
        flex-wrap: wrap;
        gap: 8px 12px;
        padding: 8px 10px;
        font-size: 0.8rem;
    }
    .chub-stat { gap: 5px; font-size: 0.8rem; white-space: nowrap; }
    .chub-char-tags { gap: 5px; }
    .chub-char-tags { --chub-tags-max-height: 56px; }
    .chub-tag { font-size: 0.75rem; padding: 3px 8px; }
    .chub-tags-more { font-size: 0.7rem; padding: 2px 6px; }
    .chub-char-section { padding: 10px 12px; }
    .chub-section-title {
        font-size: 0.85rem;
        padding: 8px 0;
        min-height: 36px;
        display: flex;
        align-items: center;
    }
    .chub-section-count { font-size: 0.75rem; }
    .scrolling-text {
        font-size: 0.85rem;
        line-height: 1.6;
    }
    .chub-alt-greeting summary { padding: 8px 10px; gap: 8px; }
    .chub-alt-greeting-index { font-size: 0.7rem; padding: 2px 6px; }
    .chub-alt-greeting-preview { font-size: 0.78rem; }
    .chub-alt-greeting-body { font-size: 0.85rem; }

    /* Card updates modal (mobile) */
    .card-update-modal .cl-modal-content {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
        border: none !important;
    }
    .card-update-modal .cl-modal-header {
        padding: 10px 12px;
        gap: 8px;
        flex-wrap: wrap;
        position: sticky;
        top: 0;
        background: var(--cl-glass-bg, rgba(30, 30, 30, 0.98));
        z-index: 1;
    }
    .card-update-modal .cl-modal-body {
        max-height: calc(100vh - 120px);
        padding: 12px;
        -webkit-overflow-scrolling: touch;
    }

    .card-update-field-select {
        padding: 12px;
        border-radius: 14px;
        background: linear-gradient(140deg, rgba(40, 50, 90, 0.55), rgba(20, 20, 30, 0.75));
        border: 1px solid rgba(90, 140, 210, 0.35);
    }
    .card-update-field-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    .card-update-field-actions {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
    }
    .card-update-field-actions .cl-btn {
        padding: 6px 8px;
        font-size: 0.8rem;
    }
    .card-update-field-count {
        grid-column: 1 / -1;
        text-align: center;
    }
    .card-update-field-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    .card-update-field-option {
        padding: 10px 12px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* =============================================
       Batch list — compact iOS-style cells
       Each row: [name + clamped path] ... [status badge] [>]
       Fits ~8+ items on screen before scrolling
       ============================================= */
    .card-update-batch-list {
        display: flex;
        flex-direction: column;
        gap: 1px;
        overflow-x: hidden;
        max-height: none;
        overflow-y: visible;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .card-update-batch-item {
        flex-direction: row;
        align-items: center;
        gap: 10px;
        padding: 9px 12px;
        border-radius: 0;
        background: rgba(255, 255, 255, 0.02);
        border: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        width: auto;
        min-height: 44px;
        box-sizing: border-box;
    }
    .card-update-batch-item:last-child {
        border-bottom: none;
    }
    .card-update-batch-item:first-child {
        border-radius: 12px 12px 0 0;
    }
    .card-update-batch-item:last-child {
        border-radius: 0 0 12px 12px;
    }
    .card-update-batch-item:only-child {
        border-radius: 12px;
    }

    /* Info column — name + path, single lines, truncated */
    .card-update-batch-item-info {
        width: auto;
        flex: 1;
        min-width: 0;
        gap: 1px;
    }
    .card-update-batch-item-name {
        font-size: 0.88rem;
        font-weight: 600;
        line-height: 1.25;
    }
    .card-update-batch-item-path {
        font-size: 0.72rem;
        opacity: 0.5;
        line-height: 1.2;
    }
    .card-update-batch-item-name,
    .card-update-batch-item-path {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        word-break: normal;
        overflow-wrap: normal;
    }

    /* Status area — compact inline badges */
    .card-update-batch-item-status {
        width: auto;
        justify-content: flex-end;
        gap: 6px;
        flex-wrap: nowrap;
        flex-shrink: 0;
        font-size: 0.78rem;
        white-space: nowrap;
    }

    /* Status badge — "3 updates" pill */
    .card-update-batch-item-status .has-updates {
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.01em;
    }

    /* View button → compact pill instead of full-width block */
    .card-update-batch-view-btn {
        width: auto;
        padding: 3px 10px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .card-update-diff-item.short {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    .card-update-diff-values {
        width: 100%;
        display: grid;
        grid-template-columns: minmax(0, 1fr) auto minmax(0, 1fr);
        align-items: center;
        gap: 6px;
    }
    .card-update-diff-values .local-value,
    .card-update-diff-values .remote-value {
        white-space: normal;
        max-width: none;
        width: auto;
        display: block;
    }

    .card-update-array-diff {
        grid-template-columns: 1fr;
    }
    .card-update-array-list {
        max-height: none;
        overflow: visible;
    }
    .card-update-pill {
        font-size: 0.78em;
        padding: 3px 8px;
    }

    .card-update-diff-sidebyside {
        grid-template-columns: 1fr;
    }
    .card-update-diff-panel.local {
        border-right: none;
        border-bottom: 1px solid rgba(80,80,80,0.3);
    }
    .card-update-diff-panel-content {
        max-height: none;
        overflow: visible;
    }
    /* =============================================
       Batch modal footer — mobile
       States:  idle     → [Start Check] [Close]
                checking → [Pause]       [Close]
                paused   → [Apply All ···········]    (full row, primary CTA)
                           [Resume]      [Close]
                done     → [Apply All ···········]    (full row, primary CTA)
                                         [Close]
       ============================================= */
    .card-update-modal .cl-modal-footer {
        padding: 12px;
        gap: 8px;
        display: flex;
        flex-wrap: wrap;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
        background: var(--cl-glass-bg, rgba(30, 30, 30, 0.98));
        position: sticky;
        bottom: 0;
        z-index: 1;
    }

    /* Uniform button sizing — every button in the footer */
    .card-update-modal .cl-modal-footer .cl-btn,
    .card-update-modal .cl-modal-footer .card-update-pause-btn {
        height: 44px;
        padding: 0 16px;
        border-radius: 12px;
        font-size: 0.92rem;
        font-weight: 500;
        box-sizing: border-box;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        flex: 1 1 0;
        min-width: 0;
    }

    /* Apply progress bar — full width row */
    .card-update-modal .cl-modal-footer .card-update-apply-progress {
        flex: 0 0 100%;
        order: -2;
    }

    /* Apply All wrapper — full width, primary CTA row */
    .card-update-batch-actions {
        flex: 0 0 100% !important;
        order: -1;
        padding-top: 0;
        border-top: none;
        margin-top: 0;
        gap: 0;
    }
    .card-update-batch-actions .cl-btn {
        width: 100%;
        height: 48px;          /* slightly taller — primary action */
        font-size: 0.95rem;
        font-weight: 600;
        border-radius: 12px;
        letter-spacing: 0.01em;
    }

    /* Pause / Resume — colour variants */
    .card-update-pause-btn {
        font-weight: 600 !important;
    }
    .card-update-pause-btn.pause {
        background: rgba(255, 152, 0, 0.18) !important;
        border: 1px solid rgba(255, 152, 0, 0.4) !important;
        color: #ffd54f !important;
    }
    .card-update-pause-btn.resume {
        background: rgba(76, 175, 80, 0.18) !important;
        border: 1px solid rgba(76, 175, 80, 0.4) !important;
        color: #81c784 !important;
    }

    /* Batch progress text - mobile */
    .card-update-batch-progress {
        padding: 12px 14px;
        font-size: 0.9rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.75);
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        margin-top: 8px;
    }

    /* ---------------------------------------------------
       TOAST NOTIFICATIONS – top-anchored on mobile
       Keeps toasts out of the way of bottom buttons
       --------------------------------------------------- */
    .toast-container {
        top: calc(env(safe-area-inset-top, 0px) + 54px) !important;
        bottom: auto !important;
        right: 12px !important;
        left: 12px !important;
        flex-direction: column !important;   /* newest at top */
    }
    .toast {
        min-width: unset !important;
        max-width: 100% !important;
        font-size: 0.85rem;
        padding: 10px 14px;
        animation: mobileToastSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }
    .toast.hiding {
        animation: mobileToastSlideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards !important;
    }

    @keyframes mobileToastSlideIn {
        from { transform: translateY(-100%); opacity: 0; }
        to   { transform: translateY(0);     opacity: 1; }
    }
    @keyframes mobileToastSlideOut {
        from { transform: translateY(0);     opacity: 1; }
        to   { transform: translateY(-100%); opacity: 0; }
    }

    /* ---------------------------------------------------
       CONTEXT MENU → hidden on mobile (replaced by bottom sheet)
       --------------------------------------------------- */
    .cl-context-menu {
        display: none !important;  /* always hidden – mobile uses bottom sheet */
    }

    /* Mobile context-menu bottom sheet */
    .mobile-ctx-scrim {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 9000;
    }
    .mobile-ctx-scrim.visible { display: block; }

    .mobile-ctx-sheet {
        position: fixed;
        bottom: 0; left: 0; right: 0;
        background: var(--bg-secondary, #1e1e2e);
        border-top: 1px solid rgba(255,255,255,0.1);
        border-radius: 16px 16px 0 0;
        z-index: 9001;
        max-height: 75vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding: 0 0 env(safe-area-inset-bottom, 8px) 0;
        transform: translateY(100%);
        transition: transform 0.28s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .mobile-ctx-sheet.visible {
        transform: translateY(0);
    }

    .mobile-ctx-handle {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px 0 4px;
        cursor: pointer;
    }
    .mobile-ctx-handle-bar {
        width: 40px; height: 4px;
        border-radius: 2px;
        background: rgba(255,255,255,0.3);
    }

    /* Items inside the sheet inherit context-menu styling */
    .mobile-ctx-sheet .cl-context-menu-separator {
        height: 1px;
        background: rgba(255,255,255,0.08);
        margin: 4px 12px;
    }
    .mobile-ctx-sheet .cl-context-menu-header {
        padding: 10px 20px 6px;
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--text-secondary, #999);
        font-weight: 600;
    }
    .mobile-ctx-sheet .cl-context-menu-item {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 14px 20px;
        min-height: 48px;
        font-size: 0.9rem;
        color: var(--text-primary, #eee);
        cursor: pointer;
        border-radius: 0;
        transition: background 0.15s;
    }
    .mobile-ctx-sheet .cl-context-menu-item:active {
        background: rgba(255,255,255,0.08);
    }
    .mobile-ctx-sheet .cl-context-menu-item i {
        width: 22px;
        text-align: center;
        opacity: 0.8;
        font-size: 1rem;
    }
    .mobile-ctx-sheet .cl-context-menu-item.danger {
        color: #ff6b7a;
    }

    /* ---------------------------------------------------
       GALLERY VIEWER (injected by gallery-viewer.js)
       --------------------------------------------------- */
    .gv-header { padding: 10px 12px; }
    .gv-header-left { font-size: 0.85em; gap: 6px; }
    .gv-btn { width: 40px; height: 40px; }
    .gv-nav { display: none !important; } /* hidden on mobile – swipe to navigate */
    .gv-thumbnails { padding: 8px 12px; gap: 6px; }
    .gv-thumb { width: 50px; height: 50px; }
    .gv-footer { padding: 8px 12px; }
    .gv-filename { font-size: 0.75em; }
    .gv-image-container {
        padding: 0;
        touch-action: none; /* JS handles all touch gestures */
        overflow: hidden;
        user-select: none;
        -webkit-user-select: none;
    }
    .gv-content {
        touch-action: none;
        overflow: hidden;
    }
    .gv-image {
        transform-origin: center center;
        will-change: transform;
    }

    /* ---------------------------------------------------
       MULTI-SELECT TOOLBAR (injected by module-loader.js)
       Smooth show/hide — no layout shift flash
       --------------------------------------------------- */
    .multi-select-toolbar {
        flex-wrap: wrap;
        padding: 8px 10px;
        gap: 8px;
        flex-shrink: 0;
        max-height: 120px;       /* enough for wrapped layout */
        transition: max-height 0.2s ease, padding 0.2s ease, opacity 0.15s ease;
        overflow: hidden;
    }
    .multi-select-toolbar.hidden {
        display: flex !important; /* keep in flow — animate instead of display:none */
        max-height: 0 !important;
        padding-top: 0 !important;
        padding-bottom: 0 !important;
        opacity: 0;
        pointer-events: none;
        border-bottom: none !important;
        box-shadow: none !important;
    }
    .multi-select-left {
        gap: 6px;
        flex-shrink: 0;
    }
    .multi-select-badge {
        padding: 4px 10px;
        font-size: 0.8em;
        gap: 6px;
    }
    .multi-select-label {
        display: none; /* hide "characters selected" text */
    }
    .multi-select-actions {
        flex: 1 1 auto;
        flex-wrap: wrap;
        gap: 4px;
        justify-content: flex-start;
        min-width: 0;
    }
    .ms-btn {
        padding: 6px 8px;
        font-size: 0.78em;
        gap: 4px;
    }
    .ms-btn span {
        display: none; /* icon-only on mobile */
    }
    .ms-divider {
        display: none; /* hide dividers to save space */
    }
    .multi-select-right {
        gap: 4px;
    }
    .ms-btn-exit {
        padding: 6px 8px;
    }

    /* ---------------------------------------------------
       BATCH TAG / CL-MODAL (injected by batch-tagging.js)
       --------------------------------------------------- */
    .cl-modal-content {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
    }
    .cl-modal-header h3 { font-size: 0.95rem; }
    .cl-modal-body { padding: 14px; }
    .cl-modal-footer { padding: 12px 14px; }
    .cl-input { font-size: 16px; } /* prevent iOS zoom */
    .cl-btn { min-height: 44px; }
    .bt-suggestions { max-height: 40vh; }

    /* ---------------------------------------------------
       CHUB LOGIN MODAL
       --------------------------------------------------- */
    .chub-login-modal {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
    }
    .chub-login-body { padding: 14px; }
    .chub-login-info { font-size: 0.85rem; padding: 12px; }
    .chub-login-actions { flex-wrap: wrap; }
    .chub-login-form .glass-input { font-size: 16px; }

    /* ---------------------------------------------------
       GALLERY SYNC DROPDOWN (moved to body via JS)
       --------------------------------------------------- */
    .gallery-sync-dropdown {
        position: fixed !important;
        left: 0 !important;
        right: 0 !important;
        top: auto !important;
        bottom: 0 !important;
        width: 100% !important;
        max-width: none !important;
        min-width: 0 !important;
        max-height: 70vh !important;
        overflow-y: auto !important;
        border-radius: 16px 16px 0 0 !important;
        border-bottom: none !important;
        z-index: 1100 !important;
        padding-bottom: env(safe-area-inset-bottom, 0px) !important;
    }

    /* ---------------------------------------------------
       CHUB LINK MODAL
       --------------------------------------------------- */
    .chub-link-modal-content {
        width: 100% !important;
        max-width: 100% !important;
        max-height: 100% !important;
        height: 100% !important;
        border-radius: 0 !important;
    }
    .chub-link-modal-body {
        flex-direction: column;
        gap: 14px;
    }

    /* Sidebar → horizontal strip with avatar + name + status */
    .chub-link-sidebar {
        flex-direction: row;
        gap: 12px;
        align-items: center;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--glass-border);
    }
    .chub-link-avatar-wrapper { flex-shrink: 0; }
    .chub-link-avatar {
        width: 48px;
        height: 48px;
        border-radius: 10px;
    }
    .chub-link-status-icon {
        width: 20px;
        height: 20px;
        font-size: 0.55rem;
        bottom: -4px;
        right: -4px;
    }
    .chub-link-char-name {
        max-width: none;
        font-size: 0.9rem;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
        min-width: 0;
    }

    /* Linked state */
    .chub-link-current-path {
        padding: 10px 12px;
        font-size: 0.85rem;
        gap: 8px;
    }
    .chub-link-current-path:hover {
        transform: none;
    }
    .chub-link-stats {
        gap: 12px;
        font-size: 0.8rem;
        flex-wrap: wrap;
    }
    .chub-link-actions {
        gap: 8px;
    }
    .chub-link-btn {
        min-height: 44px;
        font-size: 0.85rem;
        padding: 10px 16px;
        border-radius: 10px;
    }
    .chub-link-btn.primary:hover,
    .chub-link-btn.secondary:hover,
    .chub-link-btn.text-danger:hover {
        transform: none !important;
        box-shadow: none !important;
    }
    .chub-link-btn.text-danger {
        min-height: 40px;
        padding: 8px 16px;
    }
    .chub-link-btn.compact {
        min-height: 44px;
        padding: 10px 14px;
    }

    /* Search section */
    .chub-link-search-row {
        flex-wrap: wrap;
        gap: 8px;
    }
    .chub-link-search-row input {
        font-size: 16px;
        min-height: 44px;
    }
    .chub-link-search-row input:first-child {
        flex: 1 1 100%;
    }
    .chub-link-search-row input:nth-child(3) {
        flex: 1;
    }
    .chub-link-search-by {
        font-size: 0.75rem;
    }
    .chub-link-search-btn {
        min-height: 44px;
        min-width: 44px;
        padding: 10px 14px;
    }

    /* Search results */
    .chub-link-search-results {
        max-height: 50vh;
    }
    .chub-link-search-result {
        padding: 10px;
        gap: 10px;
        min-height: 44px;
    }
    .chub-link-search-result:hover {
        transform: none;
    }
    .chub-link-search-result-avatar {
        width: 40px;
        height: 40px;
        border-radius: 8px;
    }
    .chub-link-search-result-name {
        font-size: 0.85rem;
    }
    .chub-link-search-result-creator {
        font-size: 0.75rem;
    }
    .chub-link-search-result-stats {
        font-size: 0.7rem;
        gap: 8px;
    }
    .chub-link-search-result-btn {
        min-height: 36px;
        padding: 6px 12px;
        font-size: 0.78rem;
        white-space: nowrap;
        flex-shrink: 0;
    }
    .chub-link-search-empty {
        padding: 16px 12px;
        font-size: 0.82rem;
    }

    /* Divider + URL row */
    .chub-link-divider {
        margin: 10px 0;
    }
    .chub-link-url-row {
        gap: 8px;
    }
    .chub-link-url-row input {
        font-size: 16px;
        min-height: 44px;
    }

    /* ---------------------------------------------------
       SETTINGS MODAL (gallery settings)
       --------------------------------------------------- */
    .settings-modal-content {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
    }
    .settings-content { padding: 14px; }
    .settings-panel-header h4 { font-size: 0.95rem; }
    .settings-group-title { font-size: 0.85rem; }
    .settings-row { font-size: 0.85rem; }

    /* ---------------------------------------------------
       ALL CONFIRM MODALS – holistic mobile treatment
       --------------------------------------------------- */
    .confirm-modal {
        display: flex;
        align-items: flex-end !important; /* slide up from bottom */
        justify-content: center;
        padding: 0 !important;
    }
    .confirm-modal.hidden {
        display: none !important;
    }
    .confirm-modal-content {
        width: 100% !important;
        max-width: 100% !important;
        max-height: 100% !important;
        border-radius: 16px 16px 0 0 !important;
        animation: mobileSheetUp 0.3s ease-out !important;
    }
    @keyframes mobileSheetUp {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
    }
    .confirm-modal-header {
        padding: 12px 16px;
        position: sticky;
        top: 0;
        background: var(--bg-secondary);
        z-index: 1;
    }
    .confirm-modal-header h3 { font-size: 0.95rem; }
    .close-confirm-btn {
        width: 36px; height: 36px;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.2rem;
    }
    .confirm-modal-body {
        padding: 14px 16px;
        font-size: 0.85rem;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    .confirm-modal-footer {
        padding: 12px 16px;
        position: sticky;
        bottom: 0;
        background: var(--bg-secondary);
        border-top: 1px solid var(--glass-border);
        z-index: 1;
    }
    .confirm-modal-footer .action-btn {
        min-height: 44px;
        font-size: 0.85rem;
        padding: 10px 16px;
        flex: 1;
    }

    /* Full-viewport confirm modals (complex ones) */
    .import-modal-content,
    .bulk-chub-link-modal-content,
    .char-duplicates-modal-content,
    .gallery-info-modal-content,
    .bulk-summary-modal-content,
    .bulk-localize-modal-content,
    .chub-gallery-modal-content,
    .pre-import-duplicate-content {
        height: 100% !important;
        border-radius: 0 !important;
        animation: none !important;
    }

    /* --- Import modal specifics --- */
    .import-modal-content .confirm-modal-body {
        display: flex;
        flex-direction: column;
    }
    .import-urls-textarea {
        font-size: 16px; /* prevent iOS zoom */
        height: 200px;
        min-height: 200px;
        resize: vertical;
    }

    /* Import source toggle */
    .import-source-toggle {
        margin-bottom: 10px;
    }
    .import-source-btn {
        padding: 10px 12px;
        font-size: 0.85rem;
    }

    /* Import drop zone */
    .import-drop-zone {
        min-height: 150px;
        flex: 1 1 auto;
    }
    .import-drop-placeholder {
        padding: 25px 15px;
        min-height: 150px;
    }
    .import-drop-placeholder i {
        font-size: 2rem;
    }
    .import-drop-placeholder span {
        font-size: 0.85rem;
    }
    .import-file-list {
        max-height: 200px;
    }
    .import-file-item {
        padding: 6px 10px;
        font-size: 0.8rem;
    }
    .import-file-count {
        font-size: 0.8rem;
        padding: 6px 10px;
    }

    .import-options { gap: 8px; }
    .import-option-toggle {
        padding: 8px 0;
        font-size: 0.85rem;
    }
    .import-info { font-size: 0.8rem; padding: 10px; }
    .import-progress { gap: 8px; }
    .import-progress-header { font-size: 0.8rem; }
    .import-progress-bar { height: 6px; border-radius: 3px; }
    .import-log {
        max-height: 30vh;
        font-size: 0.75rem;
        padding: 8px;
    }
    .import-stats {
        flex-wrap: wrap;
        gap: 6px;
    }
    .import-stats .stat-item { font-size: 0.75rem; }
    .import-media-progress { margin-top: 8px; }

    /* --- Import summary (post-import additional content) --- */
    .import-summary-list { gap: 8px; }
    .import-summary-row {
        flex-direction: column;
        gap: 8px;
        padding: 10px;
        align-items: flex-start !important;
    }
    .import-summary-row .action-btn {
        width: 100%;
        justify-content: center;
    }
    .import-summary-row-info { gap: 2px; }
    .import-summary-row-title { font-size: 0.85rem; }
    .import-summary-row-desc { font-size: 0.75rem; }

    /* --- Localize modal --- */
    #localizeStatus { font-size: 0.85rem; }

    /* --- Bulk localize --- */
    .bulk-localize-char-info { gap: 10px; font-size: 0.85rem; }
    .bulk-localize-char-info img { width: 32px; height: 32px; border-radius: 6px; }
    .bulk-localize-stats { flex-wrap: wrap; gap: 6px; }
    .bulk-localize-stats .stat-item { font-size: 0.75rem; }

    /* --- Bulk localization summary modal --- */
    .bulk-summary-header-row {
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
    }
    .bulk-summary-stat {
        padding: 8px 12px;
        min-width: 70px;
        flex: 1;
    }
    .bulk-summary-stat:hover {
        transform: none;
    }
    .bulk-summary-stat .stat-value {
        font-size: 1.2rem;
    }
    .bulk-summary-stat .stat-label {
        font-size: 0.65rem;
    }
    .bulk-summary-media-sources {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    .bulk-summary-source {
        padding: 10px;
        border-radius: 10px;
    }
    .bulk-summary-source .source-header {
        font-size: 0.82rem;
        margin-bottom: 8px;
        padding-bottom: 6px;
        gap: 6px;
    }
    .bulk-summary-source .source-stats {
        grid-template-columns: 1fr 1fr;
        gap: 6px;
    }
    .bulk-summary-source .source-stat {
        padding: 6px 8px;
        font-size: 0.75rem;
        gap: 4px;
    }
    .bulk-summary-source .source-stat .value {
        font-size: 0.95rem;
    }
    .bulk-summary-source .source-stat .label {
        font-size: 0.65rem;
    }
    .bulk-summary-source .source-empty {
        font-size: 0.75rem;
        padding: 8px;
    }
    .bulk-summary-source .source-footer {
        font-size: 0.65rem;
        margin-top: 8px;
        padding-top: 6px;
    }
    .bulk-summary-totals {
        gap: 12px;
        padding: 10px 12px;
        flex-wrap: wrap;
        justify-content: center;
    }
    .bulk-summary-totals .total-item {
        gap: 6px;
    }
    .bulk-summary-totals .total-value {
        font-size: 1rem;
    }
    .bulk-summary-totals .total-label {
        font-size: 0.68rem;
    }
    .bulk-summary-filter {
        flex-direction: column;
        gap: 8px;
    }
    .bulk-summary-filter label {
        font-size: 0.8rem;
        display: none;
    }
    .bulk-summary-filter .glass-input,
    .bulk-summary-filter .glass-select,
    .bulk-summary-filter .custom-select-container {
        font-size: 16px;
        min-height: 40px;
        width: 100%;
        min-width: 0;
        flex: none;
    }
    .bulk-summary-filter .custom-select-trigger {
        width: 100%;
        min-width: 0 !important;
    }
    .bulk-summary-list {
        max-height: none;
    }
    .bulk-summary-item {
        padding: 10px 12px;
        gap: 10px;
    }
    .bulk-summary-item img {
        width: 30px;
        height: 30px;
    }
    .bulk-summary-item .char-name,
    .bulk-summary-item .char-name-link {
        font-size: 0.82rem;
    }
    .bulk-summary-item .char-stats {
        gap: 6px;
        font-size: 0.7rem;
        flex-wrap: wrap;
    }
    .bulk-summary-item .media-source-group {
        padding: 3px 6px;
        font-size: 0.68rem;
    }
    .bulk-summary-pagination {
        gap: 10px;
        margin-top: 10px;
        padding-top: 10px;
    }
    .bulk-summary-pagination span {
        font-size: 0.8rem;
    }
    .bulk-summary-pagination .glass-btn {
        min-height: 36px;
        min-width: 36px;
    }

    /* --- Bulk ChubAI Link --- */
    .bulk-chub-link-tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .bulk-chub-link-list-container { max-height: 40vh; }
    .bulk-chub-link-scan-stats { flex-wrap: wrap; gap: 6px; }
    .bulk-chub-link-scan-stats .stat-item { font-size: 0.75rem; }
    .bulk-chub-link-actions { flex-wrap: wrap; gap: 6px; }
    .bulk-chub-link-actions .action-btn { flex: 1; min-width: 120px; }

    /* --- Gallery info / Help & Tips modal (fullscreen like settings) --- */
    .gallery-info-modal-content {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
        animation: none !important;
        display: flex;
        flex-direction: column;
    }
    .gallery-info-modal-content .confirm-modal-header {
        padding: 14px 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid var(--glass-border);
        flex-shrink: 0;
    }
    .gallery-info-modal-content .confirm-modal-header h3 {
        font-size: 1rem;
        margin: 0;
    }
    .gallery-info-body {
        padding: 16px;
        font-size: 0.85rem;
        max-height: none !important;
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    .gallery-info-modal-content .confirm-modal-footer {
        flex-shrink: 0;
    }
    .info-section {
        margin-bottom: 16px;
        padding-bottom: 14px;
    }
    .info-section h4 {
        font-size: 0.95rem;
        gap: 6px;
        margin-bottom: 8px;
    }
    .info-section p {
        font-size: 0.85rem;
        line-height: 1.5;
        margin-bottom: 8px;
    }
    .info-section ul {
        padding-left: 18px;
        font-size: 0.85rem;
    }
    .info-section ul li {
        margin-bottom: 4px;
        line-height: 1.4;
    }
    .info-code-list { gap: 6px; }
    .info-code-item {
        padding: 8px 10px;
        font-size: 0.82rem;
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
    }
    .info-code-item code {
        font-size: 0.8rem;
        padding: 2px 6px;
    }
    .info-code-item span {
        font-size: 0.8rem;
    }
    .info-tip {
        font-size: 0.82rem;
        padding: 8px 12px;
        margin-top: 8px;
    }
    .info-section-dev {
        padding: 12px;
        border-radius: 6px;
    }
    .tag-state-example {
        font-size: 0.8rem;
        padding: 1px 6px;
    }

    /* --- Duplicate scanner --- */
    .char-duplicates-modal-content {
        min-width: unset !important;
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
    }
    .char-duplicates-modal-content .confirm-modal-body {
        max-height: none;
        overflow-x: hidden;
        padding: 10px;
    }
    .char-duplicates-status { font-size: 0.85rem; }
    .char-duplicates-results { gap: 8px; }

    /* Duplicate group cards */
    .char-dup-group-header { padding: 8px 10px; gap: 8px; }
    .char-dup-group-avatar { width: 28px; height: 28px; }
    .char-dup-group-name { font-size: 0.8rem; }
    .char-dup-group-meta { font-size: 0.65rem; gap: 6px; flex-wrap: wrap; }
    .char-dup-group-confidence { font-size: 0.55rem; }

    /* Side-by-side comparison → stacked vertically */
    .char-dup-comparison {
        grid-template-columns: 1fr !important;
        gap: 10px;
        padding: 10px;
    }
    .char-dup-card {
        min-width: unset !important;
        padding: 10px;
        font-size: 0.75rem;
    }
    .char-dup-card-avatar {
        width: 40px; height: 40px;
    }
    .char-dup-card-header { gap: 8px; margin-bottom: 8px; }
    .char-dup-card-name { font-size: 0.8rem; }
    .char-dup-card-creator { font-size: 0.7rem; }
    .char-dup-card-meta { gap: 4px; font-size: 0.7rem; }
    .char-dup-card-meta-item { padding: 2px 5px; }
    .char-dup-card-diffs { gap: 3px; }
    .diff-badge { font-size: 0.6rem; padding: 2px 4px; }
    .char-dup-card-actions {
        flex-wrap: wrap;
        gap: 6px;
        padding-top: 8px;
    }
    .char-dup-card-actions .action-btn {
        flex: 1;
        min-width: 80px;
        font-size: 0.7rem;
        padding: 6px 8px;
    }

    /* Diff sections */
    .char-dup-diff-container { margin: 0 10px 10px; gap: 8px; }
    .char-dup-diff details { padding: 8px 10px; }
    .char-dup-diff summary { font-size: 0.75rem; }
    .char-dup-diff-grid { grid-template-columns: 1fr !important; gap: 6px; }
    .char-dup-diff-content { font-size: 0.7rem; max-height: 150px; padding: 8px; }
    .char-dup-diff-label { font-size: 0.65rem; }
    .char-dup-diff-content-label { font-size: 0.6rem; }

    /* Meta diffs in the center column → hidden (merged into cards on mobile) */
    .char-dup-meta-diffs {
        display: none;
    }

    /* Divider between stacked cards */
    .char-dup-divider {
        flex-direction: row;
        padding: 4px 0;
        gap: 8px;
        min-width: unset;
        max-width: none;
    }
    .char-dup-divider i.fa-arrows-left-right {
        transform: rotate(90deg);
        font-size: 0.85rem;
    }
    .char-dup-divider .match-score { font-size: 0.65rem; }
    .char-dup-divider .match-reason { font-size: 0.6rem; text-align: center; }
    .char-dup-divider .match-breakdown { font-size: 0.55rem; }

    /* Identical content notice */
    .char-dup-identical-notice {
        margin: 0 10px 10px;
        padding: 10px 12px;
    }
    .identical-notice-header { font-size: 0.75rem; gap: 6px; margin-bottom: 6px; }
    .identical-notice-header i { font-size: 0.85rem; }
    .identical-notice-hint { font-size: 0.68rem; }
    .meta-diffs { padding: 8px 10px; gap: 4px; margin-bottom: 8px; }
    .meta-diff-item { font-size: 0.68rem; gap: 6px; }
    .meta-diff-item code { font-size: 0.6rem; max-width: 140px; }
    .ws-diff-note { font-size: 0.68rem; padding: 4px 8px; }

    /* Card labels */
    .char-dup-card-label {
        font-size: 0.6rem;
        top: -8px;
        left: 10px;
        padding: 1px 8px;
    }

    /* Delete duplicate confirmation modal */
    .dup-delete-char-info {
        gap: 10px;
        padding: 12px;
    }
    .dup-delete-avatar {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        border-width: 2px;
    }
    .dup-delete-char-details h4 { font-size: 0.95rem; }
    .dup-delete-char-details p { font-size: 0.8rem; }

    /* Gallery transfer section in delete modal */
    .dup-delete-transfer-section {
        padding: 12px;
        margin-bottom: 14px;
    }
    .dup-delete-transfer-header { font-size: 0.8rem; margin-bottom: 8px; }
    .dup-delete-transfer-warning { font-size: 0.75rem; }
    .dup-delete-transfer-radio {
        padding: 8px 10px;
        font-size: 0.75rem;
    }
    .dup-delete-transfer-radio img {
        width: 28px;
        height: 28px;
    }

    /* --- Pre-import duplicate warning --- */
    .pre-import-info { font-size: 0.85rem; }
    .pre-import-matches { gap: 8px; max-height: 40vh; }

    /* --- Save confirmation (diff view) --- */
    .changes-diff {
        font-size: 0.8rem;
        max-height: 50vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* --- Settings modal sidebar → horizontal scroll strip --- */
    .settings-modal-content {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 0 !important;
        animation: none !important;
    }
    .settings-layout {
        flex-direction: column !important;
        height: 100% !important;
    }
    .settings-sidebar {
        width: 100% !important;
        min-width: unset !important;
        border-right: none !important;
        border-bottom: 1px solid var(--glass-border) !important;
        padding: 0 !important;
        flex-shrink: 0;
    }
    .settings-nav {
        display: flex !important;
        flex-direction: row !important;
        overflow-x: auto !important;
        padding: 6px !important;
        gap: 4px !important;
        -webkit-overflow-scrolling: touch;
    }
    .settings-nav-item {
        white-space: nowrap;
        flex-shrink: 0;
        padding: 8px 12px !important;
        border-radius: 6px !important;
        min-height: 36px;
    }
    .settings-nav-item span { display: none !important; }
    .settings-nav-item i { font-size: 1rem !important; margin: 0 !important; }
    .settings-body {
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    .settings-content { padding: 14px; }
    .settings-panel-header h4 { font-size: 0.95rem; }
    .settings-group-title { font-size: 0.85rem; }
    .settings-row { font-size: 0.85rem; }

    /* ---------------------------------------------------
       GALLERY GRID  (characters view)
       --------------------------------------------------- */
    .gallery-content {
        padding: 10px;
        padding-bottom: max(20px, env(safe-area-inset-bottom, 0px));
        flex: 1 1 0%;
        min-height: 0;          /* allow flex shrinking below content size */
        overflow-y: scroll !important;
        overflow-x: hidden !important;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
        scroll-behavior: auto;
    }
    .character-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 20px; /* MUST match GRID_GAP=20 in library.js virtual scroll */
        padding-bottom: 20px;
    }
    .char-card {
        border-radius: 8px;
        contain: layout style paint;
        background: var(--card-bg, #1a1a2e);
    }
    .card-image {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .card-overlay { padding: 6px 5px 5px; }
    .card-name { font-size: 0.75rem; margin-bottom: 2px; }
    .card-tags { gap: 2px; font-size: 0.55rem; }
    .card-tag { padding: 1px 4px; border-radius: 3px; }
    .char-card .favorite-indicator {
        width: 20px; height: 20px; font-size: 10px;
        top: 4px; right: 4px;
    }

    /* ---------------------------------------------------
       CHATS VIEW  (main view)
       --------------------------------------------------- */
    .chats-view {
        padding: 8px;
        padding-bottom: max(20px, env(safe-area-inset-bottom, 0px));
    }
    .chats-grid {
        grid-template-columns: 1fr;
        gap: 8px;
    }

    /* Flat chat cards — compact list rows */
    .chat-card {
        border-radius: 10px;
        overflow: hidden;
    }
    .chat-card:hover {
        transform: none;
        box-shadow: none;
    }
    .chat-card-header {
        padding: 8px 10px;
        gap: 8px;
    }
    .chat-card-avatar,
    .chat-card-avatar-fallback {
        width: 36px;
        height: 36px;
    }
    .chat-card-char-name {
        font-size: 0.85rem;
    }
    .chat-card-chat-name {
        font-size: 0.72rem;
    }
    .chat-card-body {
        padding: 0 10px 8px;
        gap: 4px;
    }
    .chat-card-preview {
        font-size: 0.78rem !important;
        line-height: 1.4 !important;
        padding: 6px 8px !important;
        min-height: 0 !important;
        max-height: 3.2em !important;
        display: block !important;
        -webkit-line-clamp: unset !important;
        line-clamp: unset !important;
        -webkit-box-orient: unset !important;
        overflow: hidden !important;
        border-radius: 6px;
        word-break: break-word;
    }
    .chat-card-footer {
        padding: 6px 10px;
        font-size: 0.7rem;
    }
    .chat-card-meta {
        gap: 8px;
    }
    .chat-card-actions {
        opacity: 1;
        gap: 4px;
    }
    .chat-card-action {
        padding: 6px 10px;
        font-size: 0.72rem;
        min-height: 32px;
        display: flex;
        align-items: center;
        border-radius: 6px;
    }
    .chat-card.active::before {
        font-size: 0.55rem;
        top: 4px;
        right: 4px;
        padding: 2px 5px;
    }
    .chat-model-badge {
        max-width: 100px;
        font-size: 0.62rem;
        padding: 1px 5px;
    }

    /* Grouped chats view — iOS-style sections */
    .chats-grouped-view { gap: 8px; }
    .chat-group {
        border-radius: 10px;
        overflow: hidden;
    }
    .chat-group-header {
        padding: 10px 12px;
        gap: 10px;
        min-height: 44px;
    }
    .chat-group-header:hover { background: rgba(0, 0, 0, 0.25); }
    .chat-group-avatar,
    .chat-group-avatar-fallback { width: 36px; height: 36px; }
    .chat-group-name { font-size: 0.88rem; }
    .chat-group-count { font-size: 0.75rem; }
    .chat-group-toggle { font-size: 0.8rem; }
    .chat-group-item {
        padding: 10px 12px 10px 16px;
        gap: 10px;
        min-height: 44px;
    }
    .chat-group-item:hover { background: none; }
    .chat-group-item-icon { font-size: 0.9rem; }
    .chat-group-item-name { font-size: 0.78rem; }
    .chat-group-item-preview {
        display: none;
    }
    .chat-group-item-meta {
        font-size: 0.72rem;
        gap: 8px;
        display: flex;
        align-items: center;
        flex-wrap: nowrap;
    }
    .chat-group-item-meta > span {
        display: inline-flex;
        align-items: center;
        flex-shrink: 0;
        gap: 3px;
    }
    .chat-group-item-actions {
        opacity: 1;
        gap: 4px;
    }
    .chat-group-item-actions .chat-card-action {
        min-height: 32px;
        padding: 6px 10px;
    }
    .chat-group-item .chat-model-badge {
        display: inline-block;
        max-width: 80px;
        height: 1.1rem;
        line-height: 1.1rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        vertical-align: middle;
    }

    /* Chat preview modal */
    .chat-preview-modal {
        width: 100% !important;
        max-width: 100% !important;
        height: 100% !important;
        border-radius: 0 !important;
    }
    .chat-preview-modal .modal-header {
        padding: 10px 12px;
        padding-right: 44px; /* room for close button */
        flex-wrap: wrap;
        gap: 8px;
        position: relative;
    }
    .chat-preview-header-info { gap: 10px; min-width: 0; width: 100%; }
    .chat-preview-header-info > div { min-width: 0; }
    .chat-preview-header-info h2 {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .chat-preview-avatar { width: 36px; height: 36px; }
    .chat-preview-meta { font-size: 0.75rem; }
    /* Chat preview modal buttons — icon-only on mobile */
    #chatPreviewOpenBtn span,
    #chatPreviewOpenBtn .btn-label {
        font-size: 0; /* hide text fallback */
    }
    #chatPreviewOpenBtn {
        font-size: 0; /* hide "Open in SillyTavern" text */
        gap: 0;
        padding: 8px 12px;
        min-width: 38px;
        justify-content: center;
    }
    #chatPreviewOpenBtn i {
        font-size: 0.9rem; /* icon stays visible */
    }
    #chatPreviewDeleteBtn {
        padding: 8px 12px;
        min-width: 38px;
        justify-content: center;
    }
    .chat-preview-modal .modal-controls {
        display: flex;
        gap: 6px;
        margin-left: auto; /* push right */
        flex-shrink: 0;
    }
    .chat-preview-modal .modal-controls .action-btn {
        min-height: 36px;
    }
    .chat-preview-modal .modal-controls .close-btn {
        position: absolute;
        top: 8px;
        right: 8px;
    }
    .chat-preview-body {
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }
    .chat-preview-messages { padding: 12px; gap: 10px; }
    .chat-message { max-width: 90%; }
    .chat-message-avatar { width: 28px; height: 28px; }
    .chat-message-content { padding: 8px 12px; font-size: 0.85rem; }
    .chat-message-name { font-size: 0.75rem; }
    .chat-message-actions { opacity: 1; }
    .chat-msg-action-btn { width: 28px; height: 28px; }
    .chat-model-badge { max-width: 120px; font-size: 0.68rem; padding: 1px 6px; }

    /* Chats empty/loading states */
    .chats-empty { padding: 40px 16px; }
    .chats-empty i { font-size: 2.5rem; }
    .chats-empty h3 { font-size: 1rem; }
    .chats-empty p { font-size: 0.85rem; }
    .chats-view .chats-loading { padding: 40px; font-size: 0.95rem; }

    /* ---------------------------------------------------
       CHUB FILTER AREA – topbar second row
       --------------------------------------------------- */
    .topbar.chub-active {
        flex-wrap: wrap !important;
    }
    .filter-area.chub-filters {
        width: 100% !important;
        order: 99;
        flex-wrap: nowrap !important;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        gap: 6px !important;
        padding: 6px 4px !important;
        border-top: 1px solid var(--glass-border);
        align-items: center;
    }
    .filter-area.chub-filters::-webkit-scrollbar { display: none; }
    .filter-area.chub-filters .glass-btn {
        flex-shrink: 0;
        font-size: 0.75rem;
        padding: 5px 8px;
        min-height: 30px;
        white-space: nowrap;
    }
    .filter-area.chub-filters .glass-select {
        flex-shrink: 0;
        font-size: 0.75rem;
        max-width: 170px;
    }
    .filter-area.chub-filters .chub-sort-container {
        flex-shrink: 0;
    }
    .filter-area.chub-filters .chub-view-toggle {
        flex-shrink: 0;
        padding: 1px;
        gap: 2px;
    }
    .filter-area.chub-filters .chub-view-btn {
        font-size: 0.72rem;
        padding: 4px 7px;
    }
    .filter-area.chub-filters .nsfw-toggle {
        min-width: auto;
    }
    .filter-area.chub-filters .nsfw-toggle span {
        display: none; /* icon only on mobile */
    }

    /* ---------------------------------------------------
       CHUB VIEW  (main view)
       --------------------------------------------------- */

    /* Tags dropdown – full width on mobile */
    .chub-tags-dropdown {
        position: fixed !important;
        left: 0 !important;
        right: 0 !important;
        top: auto !important;
        bottom: 0 !important;
        width: 100% !important;
        max-height: 60vh !important;
        border-radius: 16px 16px 0 0 !important;
        border-bottom: none !important;
        z-index: 1100 !important;
        padding-bottom: env(safe-area-inset-bottom, 0px) !important;
    }
    .chub-tags-search-row input { font-size: 16px; } /* prevent iOS zoom */
    .chub-tag-filter-item { padding: 8px 6px; } /* bigger tap targets */
    .chub-tag-state-btn { width: 28px; height: 28px; min-width: 28px; }

    /* Features dropdown – full width */
    #chubFiltersDropdown {
        position: fixed !important;
        left: 0 !important;
        right: 0 !important;
        top: auto !important;
        bottom: 0 !important;
        width: 100% !important;
        border-radius: 16px 16px 0 0 !important;
        border-bottom: none !important;
        z-index: 1100 !important;
        padding-bottom: env(safe-area-inset-bottom, 0px) !important;
    }
    .filter-checkbox { padding: 8px 12px; font-size: 0.85rem; }

    /* Chub view container */
    .chub-view { padding: 0; padding-bottom: max(12px, env(safe-area-inset-bottom, 0px)); gap: 12px; }
    .chub-section { gap: 12px; }

    /* Search bar */
    .chub-search-bar { padding: 12px; border-radius: 10px; gap: 8px; }
    .chub-search-input-wrapper { padding: 0 10px; gap: 8px; border-radius: 8px; }
    .chub-search-input-wrapper input { padding: 12px 0; font-size: 16px; } /* 16px prevents iOS zoom */
    .chub-search-input-wrapper i { font-size: 0.9rem; }
    .chub-search-submit { width: 34px; height: 34px; border-radius: 6px; }
    .chub-creator-search { margin-top: 6px; }
    .chub-creator-search-wrapper { max-width: 100%; padding: 0 10px; gap: 8px; border-radius: 8px; }
    .chub-creator-search-wrapper input { padding: 10px 0; font-size: 16px; }

    /* Author banner */
    .chub-author-banner { flex-direction: column; gap: 10px; padding: 10px 12px; }
    .chub-author-banner-content { font-size: 0.85rem; }
    .chub-author-banner-actions { width: 100%; gap: 6px; flex-wrap: wrap; }
    #chubAuthorSortSelect, [data-select-id="chubAuthorSortSelect"] { min-width: 0; flex: 1; font-size: 0.8rem; }
    #chubFollowAuthorBtn { font-size: 0.8rem; padding: 6px 10px; }

    /* Card grid */
    .chub-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 8px;
    }
    .chub-card { border-radius: 10px; }
    .chub-card:hover { transform: none; } /* disable hover lift on touch */
    .chub-card-body { padding: 8px; min-height: 60px; }
    .chub-card-name { font-size: 0.8rem; }
    .chub-card-creator { font-size: 0.7rem; margin-bottom: 4px; }
    .chub-card-tags { display: none !important; }
    .chub-nsfw-badge { font-size: 0.6rem; padding: 2px 5px; top: 5px; right: 5px; }
    .chub-card-footer { padding: 6px 8px; font-size: 0.65rem; min-height: 32px; }
    .chub-card-stat { font-size: 0.65rem; }
    .chub-card-date { font-size: 0.6rem; }

    /* Load more */
    .chub-load-more { padding: 12px; }
    .chub-load-more .glass-btn { padding: 10px 24px; font-size: 0.85rem; }

    /* Timeline header */
    .chub-timeline-header { padding: 12px 14px; border-radius: 10px; margin-bottom: 10px; }
    .chub-timeline-header h3 { font-size: 1rem; }
    .chub-timeline-header p { font-size: 0.8rem; }

    /* Timeline empty */
    .chub-timeline-empty { padding: 40px 16px; }
    .chub-timeline-empty i { font-size: 2rem; }
    .chub-timeline-empty h3 { font-size: 1rem; }

    /* Chub loading/error/empty states */
    .chub-loading, .chub-error, .chub-empty { padding: 40px 16px; }

    /* ChubAI character detail modal */
    .chub-char-body { padding: 12px; }
    .chub-char-description { font-size: 0.85rem; line-height: 1.6; }
}


/* ========================================
   PHONE  (max-width: 480px)
   Overrides on top of the shared block
   ======================================== */
@media screen and (max-width: 480px) {

    /* Topbar */
    .topbar {
        height: auto;
        min-height: 44px;
        padding: 5px 8px;
        gap: 4px;
        flex-wrap: nowrap;
        overflow: visible;
    }
    .logo-area { flex-shrink: 0; gap: 0; }
    .logo-area h1,
    .logo-area span { display: none; }

    .view-toggle { flex-shrink: 0; padding: 2px; gap: 2px; }
    .view-toggle-btn {
        min-width: 38px; min-height: 32px;
        padding: 5px;
        font-size: 0;            /* hides text */
        gap: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .view-toggle-btn i { font-size: 0.85rem; margin: 0; padding: 0; }

    #mobileSearchBtn,
    #mobileSettingsBtn,
    #mobileMenuBtn {
        min-width: 32px; min-height: 32px;
    }

    /* Grid – smaller cards */
    .character-grid {
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
        gap: 20px; /* MUST match GRID_GAP=20 in library.js virtual scroll */
    }

    /* Chub grid tighter */
    .chub-grid {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 6px;
    }

    /* ---- Inline Tags Row in Edit tab ---- */
    .edit-tags-row {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .edit-tags-row > label {
        display: flex;
        align-items: center;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .edit-tags-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        min-height: 28px;
        align-items: center;
    }

    .edit-tags-preview:empty::before {
        content: 'No tags';
        color: var(--text-secondary);
        font-size: 0.85rem;
        font-style: italic;
    }

    .edit-tags-preview .modal-tag {
        font-size: 0.75rem;
        padding: 3px 8px;
        opacity: 0.85;
    }

    .edit-tags-btn {
        align-self: flex-start;
        font-size: 0.8rem !important;
        padding: 6px 14px !important;
        gap: 6px !important;
    }

    /* ---- Tag Editor Sheet (slide-up panel) ---- */
    .tag-editor-sheet {
        position: fixed;
        inset: 0;
        z-index: 250;
        display: flex;
        align-items: flex-end;
        justify-content: center;
    }

    .tag-editor-sheet.hidden { display: none; }

    .tag-editor-sheet-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(3px);
    }

    .tag-editor-sheet-panel {
        position: relative;
        width: 100%;
        max-width: 520px;
        max-height: 85vh;
        background: var(--modal-bg, rgba(28, 30, 38, 0.98));
        border: 1px solid var(--glass-border);
        border-bottom: none;
        border-radius: 16px 16px 0 0;
        display: flex;
        flex-direction: column;
        box-shadow: 0 -8px 40px rgba(0, 0, 0, 0.5);
        animation: sheetSlideUp 0.25s ease-out;
    }

    @keyframes sheetSlideUp {
        from { transform: translateY(100%); }
        to   { transform: translateY(0); }
    }

    .tag-editor-sheet-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 18px;
        border-bottom: 1px solid var(--glass-border);
        flex-shrink: 0;
    }

    .tag-editor-sheet-header h3 {
        margin: 0;
        font-size: 1rem;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    /* Body: input at top (order:-1), suggestions inline, tags scroll */
    .tag-editor-sheet-body {
        flex: 1;
        overflow: hidden;
        min-height: 0;
        padding: 12px 16px 8px;
        display: flex;
        flex-direction: column;
        gap: 0;
    }

    /* Input row pinned to top via order */
    .tag-editor-sheet-input-row {
        order: -1;
        position: static;
        flex-shrink: 0;
        padding: 0 0 6px;
    }

    .tag-editor-sheet-footer {
        display: flex;
        justify-content: flex-end;
        padding: 12px 18px;
        border-top: 1px solid var(--glass-border);
        flex-shrink: 0;
    }

    /* ---- Autocomplete: inline suggestion pills ---- */
    #tagEditorSheetAutocomplete.tag-autocomplete {
        position: static;
        max-height: none;
        overflow: visible;
        background: transparent;
        border: none;
        border-radius: 0;
        display: none;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px 0 2px;
    }

    #tagEditorSheetAutocomplete.tag-autocomplete.visible {
        display: flex;
    }

    /* Suggestion pills — dashed border, accent tint */
    #tagEditorSheetAutocomplete .tag-autocomplete-item {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 7px 14px;
        border-radius: 20px;
        background: rgba(74, 158, 255, 0.08);
        border: 1.5px dashed rgba(74, 158, 255, 0.35);
        color: rgba(74, 158, 255, 0.95);
        font-size: 0.82rem;
        line-height: 1;
        cursor: pointer;
        transition: background 0.15s ease, transform 0.1s ease;
        -webkit-tap-highlight-color: transparent;
    }

    #tagEditorSheetAutocomplete .tag-autocomplete-item:active {
        background: rgba(74, 158, 255, 0.22);
        border-style: solid;
        transform: scale(0.95);
    }

    /* "Create new tag" pill — green tint */
    #tagEditorSheetAutocomplete .tag-autocomplete-item.create-new {
        border-color: rgba(100, 210, 100, 0.4);
        color: rgba(100, 210, 100, 0.95);
        background: rgba(100, 210, 100, 0.08);
        font-style: normal;
    }

    #tagEditorSheetAutocomplete .tag-autocomplete-item.create-new:active {
        background: rgba(100, 210, 100, 0.22);
    }

    /* ---- Existing tags: scrollable area ---- */
    .tag-editor-sheet-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        min-height: 48px;
        flex: 1;
        overflow-y: auto;
        padding-top: 10px;
        margin-top: 6px;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
    }

    .tag-editor-sheet-tags:empty::before {
        content: 'No tags yet — type above to add.';
        color: var(--text-secondary);
        font-size: 0.85rem;
        font-style: italic;
    }

    /* Tag pills: larger touch targets, rounded chips */
    .tag-editor-sheet-tags .modal-tag.editable {
        padding: 8px 10px 8px 14px;
        border-radius: 20px;
        font-size: 0.82rem;
    }

    .tag-editor-sheet-tags .tag-remove-btn {
        width: 22px;
        height: 22px;
        min-width: 22px;
        font-size: 10px;
    }

    /* Scrollable sidebar tag container */
    .tags-container {
        max-height: 200px;
        overflow-y: auto;
    }

}


/* ========================================
   TABLET  (481px – 768px)
   Slightly more room than phone
   ======================================== */
@media screen and (min-width: 481px) and (max-width: 768px) {

    .topbar {
        height: auto;
        min-height: 48px;
        padding: 6px 12px;
        gap: 6px;
        flex-wrap: nowrap;
    }
    .logo-area h1 { font-size: 0.95rem; }

    .view-toggle-btn { padding: 6px 10px; font-size: 0.82rem; }

    #mobileSearchBtn,
    #mobileSettingsBtn,
    #mobileMenuBtn {
        min-width: 36px; min-height: 36px;
    }

    /* Tablet gets slightly larger cards */
    .character-grid {
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        gap: 20px; /* MUST match GRID_GAP=20 in library.js virtual scroll */
    }
}


/* ========================================
   LANDSCAPE PHONE
   ======================================== */
@media screen and (max-width: 768px) and (orientation: landscape) {
    .mobile-sheet { max-height: 85vh; }
}

